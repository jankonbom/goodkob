<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Panel Admin Complet - DarkLabbb Shop</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin-style.css">
    <style>
        /* Variables CSS coh√©rentes avec le site principal */
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-card: #21262d;
            --bg-hover: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-orange: #ffa657;
            --border-color: #30363d;
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 20px rgba(88, 166, 255, 0.3);
        }

        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header moderne */
        .admin-header {
            background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .admin-logo {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .admin-logo-img:hover {
            transform: scale(1.05);
        }

        .header-left h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .header-right {
            display: flex;
            gap: 12px;
        }

        /* Boutons modernes */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), #1f6feb);
            color: white;
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(88, 166, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent-red), #da3633);
            color: white;
            box-shadow: 0 4px 12px rgba(248, 81, 73, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(248, 81, 73, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-icon {
            font-size: 16px;
        }

        /* Navigation moderne */
        .admin-nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0 24px;
        }

        .nav-content {
            display: flex;
            gap: 8px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 0;
        }

        .nav-item {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--accent-blue);
            color: white;
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
        }

        .nav-icon {
            font-size: 16px;
        }

        .nav-text {
            font-weight: 500;
        }

        /* Contenu principal */
        .admin-main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        /* Filtres modernes */
        .filters-bar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 16px;
        }

        .filters-bar select {
            padding: 14px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filters-bar select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        /* Grille d'articles moderne */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        .article-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--accent-blue);
        }

        .article-image-container {
            position: relative;
            height: 200px;
            overflow: hidden;
            background: var(--bg-secondary);
        }

        .article-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            transition: transform 0.3s ease;
            background: var(--bg-secondary);
        }

        .article-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .article-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0;
        }

        .article-card:hover .article-image {
            transform: scale(1.05);
        }

        .article-card:hover .article-image video {
            transform: scale(1.05);
        }

        .video-indicator {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }

        .article-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: white;
        }

        .article-badge.in-stock {
            background: var(--accent-green);
        }

        .article-badge.out-of-stock {
            background: var(--accent-red);
        }

        .article-content {
            padding: 20px;
        }

        .article-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
            line-height: 1.3;
        }

        .article-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0 0 12px 0;
            line-height: 1.4;
        }

        .article-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .category-stup {
            background: var(--accent-green);
            color: white;
        }

        .category-tabac {
            background: var(--accent-orange);
            color: white;
        }

        .category-puffs {
            background: #8b5cf6;
            color: white;
        }

        .price-variants {
            margin: 16px 0;
        }

        .price-variant {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .price-variant:last-child {
            border-bottom: none;
        }

        .variant-quantity {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }

        .variant-price {
            color: var(--accent-green);
            font-weight: 700;
            font-size: 16px;
        }

        .more-variants {
            color: var(--text-muted);
            font-size: 12px;
            font-style: italic;
            text-align: center;
            padding: 8px 0;
        }

        .article-stock-info {
            margin: 12px 0;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            text-align: center;
        }

        .stock-label {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .article-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .article-actions button {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-edit {
            background: var(--accent-blue);
            color: white;
        }

        .btn-edit:hover {
            background: #1f6feb;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: var(--accent-red);
            color: white;
        }

        .btn-delete:hover {
            background: #da3633;
            transform: translateY(-2px);
        }

        /* Modals modernes */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Formulaires modernes */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--text-muted);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        /* Drag & Drop moderne */
        .media-upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .media-upload-zone:hover {
            border-color: var(--accent-blue);
            background: rgba(88, 166, 255, 0.05);
        }

        .media-upload-zone.dragover {
            border-color: var(--accent-blue);
            background: rgba(88, 166, 255, 0.1);
            transform: scale(1.02);
        }

        .upload-content {
            pointer-events: none;
        }

        .upload-icon {
            font-size: 48px;
            display: block;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .upload-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .media-preview {
            margin-top: 16px;
        }

        .preview-container {
            position: relative;
            display: inline-block;
        }

        .remove-media {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-media:hover {
            background: #da3633;
            transform: scale(1.1);
        }

        /* Variantes de prix modernes */
        .price-variants-container {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            background: var(--bg-secondary);
        }

        .variant-item {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .variant-item:last-child {
            margin-bottom: 0;
        }

        .variant-quantity,
        .variant-price {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .variant-quantity::placeholder,
        .variant-price::placeholder {
            color: var(--text-muted);
        }

        .remove-variant {
            background: var(--accent-red);
            color: white;
            border: none;
            border-radius: 8px;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-variant:hover {
            background: #da3633;
            transform: scale(1.1);
        }

        /* Analytics modernes */
        .stats-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
        }

        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }

        .stats-card h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stats-card .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
        }

        /* Notifications modernes */
        .notifications-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .notification {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            animation: notificationSlideIn 0.3s ease;
            max-width: 400px;
        }

        .notification.success {
            border-left: 4px solid var(--accent-green);
        }

        .notification.error {
            border-left: 4px solid var(--accent-red);
        }

        @keyframes notificationSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Loading moderne */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1500;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-overlay p {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
        }

        /* Page de Connexion */
        .login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 50%, #21262d 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
        }

        .login-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .login-form {
            margin-bottom: 20px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .login-form input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
            font-size: 16px;
            padding: 14px 20px;
        }

        .login-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .login-footer p {
            color: var(--text-muted);
            font-size: 12px;
            margin: 0;
        }

        /* Animation d'entr√©e */
        .login-card {
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Mobile */
        @media (max-width: 768px) {
            .admin-main {
                padding: 12px;
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .filters-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                padding: 16px;
            }
            
            .search-box {
                min-width: auto;
            }

            .login-container {
                padding: 16px;
            }

            .login-card {
                padding: 30px 20px;
            }

            /* Optimisations pour les cartes d'articles sur mobile */
            .article-card {
                margin-bottom: 16px;
            }

            .article-image-container {
                height: 200px;
            }

            .article-image {
                height: 100%;
            }

            /* Boutons plus grands pour le tactile */
            .btn {
                min-height: 44px;
                padding: 12px 16px;
                font-size: 16px;
            }

            /* Modal responsive */
            .modal-content {
                width: 95%;
                max-width: 95%;
                margin: 10px auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-body {
                padding: 16px;
            }

            /* Formulaires mobiles */
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* √âvite le zoom automatique sur iOS */
                padding: 12px;
            }

            /* Navigation mobile */
            .admin-nav {
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-item {
                flex: 1;
                min-width: 120px;
                text-align: center;
                padding: 12px 8px;
            }

            /* Header mobile */
            .admin-header {
                padding: 12px 16px;
            }

            .header-content {
                flex-direction: column;
                gap: 12px;
            }

            .header-left h1 {
                font-size: 20px;
            }

            .header-right {
                width: 100%;
                justify-content: center;
            }
        }

        /* Optimisations sp√©cifiques pour les tr√®s petits √©crans */
        @media (max-width: 480px) {
            .admin-main {
                padding: 8px;
            }

            .filters-bar {
                padding: 12px;
            }

            .articles-grid {
                gap: 12px;
            }

            .article-image-container {
                height: 180px;
            }

            .modal-content {
                width: 98%;
                margin: 5px auto;
            }

            .btn {
                padding: 10px 12px;
                font-size: 14px;
            }
        }

        /* Styles sp√©cifiques pour les appareils mobiles */
        .mobile-device .article-image {
            object-fit: cover !important;
            width: 100% !important;
            height: 100% !important;
        }

        .mobile-device video {
            object-fit: cover !important;
            width: 100% !important;
            height: 100% !important;
        }

        .mobile-device .btn {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
        }

        .mobile-device .article-card {
            touch-action: manipulation;
        }

        /* Optimisations pour les vid√©os sur mobile */
        video {
            -webkit-playsinline: true;
            playsinline: true;
        }

        /* Am√©liorer la lisibilit√© sur mobile */
        @media (max-width: 768px) {
            .article-title {
                font-size: 16px;
                line-height: 1.3;
            }

            .article-description {
                font-size: 14px;
                line-height: 1.4;
            }

            .article-badge {
                font-size: 12px;
                padding: 4px 8px;
            }

            .price-variant {
                font-size: 12px;
                padding: 6px 8px;
            }
        }

        /* ===== STYLES SECTION INFORMATIONS ===== */
        .info-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .info-form-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .info-form-container h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 18px;
        }

        .info-form .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-form .form-group {
            margin-bottom: 15px;
        }

        .info-form .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .info-form .form-group input,
        .info-form .form-group textarea,
        .info-form .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .info-form .form-group input:focus,
        .info-form .form-group textarea:focus,
        .info-form .form-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .info-form .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .info-form .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .info-list-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .info-list-container h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 18px;
        }

        .info-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .info-item:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 2px 8px rgba(88, 166, 255, 0.1);
        }

        .info-item-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .info-item-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-item-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .info-item-status.active {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .info-item-status.inactive {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .info-item-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .info-item-content {
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .info-item-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .info-item-actions .btn {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Styles pour les options de personnalisation */
        .customization-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .customization-section h4 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 16px;
            font-weight: 600;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-primary);
            position: relative;
            padding-left: 30px;
        }

        .checkbox-label input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkmark {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 18px;
            width: 18px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .checkbox-label:hover .checkmark {
            border-color: var(--accent-color);
        }

        .checkbox-label input:checked ~ .checkmark {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 5px;
            top: 2px;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .checkbox-label input:checked ~ .checkmark:after {
            display: block;
        }

        input[type="color"] {
            width: 100%;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            cursor: pointer;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }

        /* Styles pour les couleurs avanc√©es */
        .advanced-colors-section, .advanced-effects-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        .advanced-colors-section h5, .advanced-effects-section h5 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .color-hex-input {
            width: 100%;
            padding: 6px 8px;
            margin-top: 4px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .opacity-slider, .effect-slider {
            width: 100%;
            margin-top: 4px;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            border-radius: 2px;
            background: var(--border-color);
            outline: none;
        }

        .opacity-slider::-webkit-slider-thumb, .effect-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .opacity-slider::-moz-range-thumb, .effect-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .opacity-value, .effect-value {
            display: inline-block;
            margin-left: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            min-width: 40px;
            text-align: right;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .checkbox-group label {
            font-size: 13px;
        }

        /* Styles pour les onglets */
        .form-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-button:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .tab-button.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            background: var(--bg-primary);
        }

        .tab-icon {
            font-size: 16px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Styles pour la pr√©visualisation */
        .preview-container {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 20px;
        }

        .preview-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-wrapper {
            position: relative;
            min-height: 400px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 8px;
            padding: 20px;
            overflow: hidden;
        }

        .live-preview {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .preview-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: var(--text-secondary);
            font-style: italic;
            text-align: center;
        }

        .preview-mobile {
            max-width: 375px;
            margin: 0 auto;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            background: #000;
        }

        .preview-desktop {
            width: 100%;
        }

        /* Styles pour la carte de pr√©visualisation */
        .preview-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .preview-card .info-header {
            margin-bottom: 15px;
        }

        .preview-card .custom-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .preview-card .custom-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0 0 15px 0;
            font-weight: 500;
        }

        .preview-card .custom-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .preview-card .custom-content strong {
            font-weight: 600;
            color: var(--accent-color);
        }

        /* Animation de transition pour les onglets */
        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive pour la section informations */
        @media (max-width: 768px) {
            .info-management {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .info-form .form-row {
                grid-template-columns: 1fr;
            }

            .info-form .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Page de Connexion -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <h1>üîê Connexion Admin</h1>
                    <p>Acc√®s s√©curis√© au panel d'administration</p>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe administrateur</label>
                        <input type="password" id="adminPassword" placeholder="Entrez le mot de passe" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">üîì Se connecter</button>
                </form>
                <div class="login-footer">
                    <p>Acc√®s r√©serv√© aux administrateurs</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel Admin (cach√© par d√©faut) -->
    <div id="adminPanel" class="admin-container" style="display: none;">
        <!-- Header Admin -->
    <header class="admin-header">
        <div class="header-content">
            <div class="header-left">
                <div class="admin-logo">
                    <img src="https://i.imgur.com/2T05Hat.jpeg" alt="DarkLabbb Logo" class="admin-logo-img">
                </div>
                <h1>Panel Administration</h1>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" onclick="loadArticles()">
                    <span class="btn-icon">üëÅÔ∏è</span>
                    Aper√ßu
                </button>
                <button class="btn btn-secondary" onclick="location.reload()">
                    <span class="btn-icon">‚ÜóÔ∏è</span>
                    D√©connexion
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Admin -->
    <nav class="admin-nav">
        <div class="nav-content">
            <button class="nav-item active" onclick="switchSection('articles')">
                <span class="nav-icon">üìÑ</span>
                <span class="nav-text">Articles</span>
            </button>
            <button class="nav-item" onclick="switchSection('categories')">
                <span class="nav-icon">üìÅ</span>
                <span class="nav-text">Cat√©gories</span>
            </button>
            <button class="nav-item" onclick="switchSection('info')">
                <span class="nav-icon">‚ÑπÔ∏è</span>
                <span class="nav-text">Informations</span>
            </button>
            <button class="nav-item" onclick="switchSection('command-messages')">
                <span class="nav-icon">üí¨</span>
                <span class="nav-text">Messages de Commande</span>
            </button>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <main class="admin-main">
        <!-- Section Articles -->
        <section id="articles-section" class="admin-section active">
            <div class="section-header">
                <h2>Gestion des Articles</h2>
                <button class="btn btn-primary" onclick="openAddModal()">
                    <span class="btn-icon">‚ûï</span>
                    Nouvel Article
                </button>
            </div>

            <!-- Filtres et Recherche -->
            <div class="filters-bar">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Rechercher un article..." onkeyup="filterArticles()">
                    <span class="search-icon">üîç</span>
                </div>
                <select id="categoryFilter" onchange="filterArticles()">
                    <option value="">Toutes les cat√©gories</option>
                    <option value="stup">STUP</option>
                    <option value="tabac">TABAC</option>
                    <option value="puffs">PUFFS</option>
                </select>
                <select id="statusFilter" onchange="filterArticles()">
                    <option value="">Tous les statuts</option>
                    <option value="active">Actif</option>
                    <option value="inactive">Inactif</option>
                </select>
                <button onclick="listAvailableBuckets()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                    üì¶ Lister Buckets
                </button>
                <button onclick="createBucketManually()" style="background: #ffc107; color: #000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                    ü™£ Cr√©er Bucket
                </button>
                <button onclick="removeProblematicArticle()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                    üóëÔ∏è Supprimer article bugu√©
                </button>
            </div>

            <!-- Liste des Articles -->
            <div class="articles-grid" id="articlesGrid">
                <div style="text-align: center; padding: 20px;">
                    <p>üîÑ Chargement des articles...</p>
                </div>
            </div>
        </section>

        <!-- Section Cat√©gories -->
        <section id="categories-section" class="admin-section">
            <div class="section-header">
                <h2>Gestion des Cat√©gories</h2>
                <button class="btn btn-primary">
                    <span class="btn-icon">‚ûï</span>
                    Nouvelle Cat√©gorie
                </button>
            </div>
            <div style="text-align: center; padding: 40px;">
                <h3>üöß Fonctionnalit√© en cours de d√©veloppement</h3>
                <p>La gestion des cat√©gories sera bient√¥t disponible.</p>
            </div>
        </section>

        <!-- Section Informations -->
        <section id="info-section" class="admin-section">
            <div class="section-header">
                <h2>Gestion des Informations</h2>
                <p>Modifiez les informations affich√©es sur le site</p>
            </div>
            <div class="section-content">
                <div class="info-management">
                        <!-- Formulaire d'ajout/modification d'information -->
                        <div class="info-form-container">
                            <div class="form-tabs">
                                <button type="button" class="tab-button active" onclick="switchTab('form')">
                                    <span class="tab-icon">üìù</span>
                                    <span class="tab-text">Formulaire</span>
                                </button>
                                <button type="button" class="tab-button" onclick="switchTab('preview')">
                                    <span class="tab-icon">üëÅÔ∏è</span>
                                    <span class="tab-text">Aper√ßu</span>
                                </button>
                            </div>
                            
                            <div id="formTab" class="tab-content active">
                                <h3>üìù Ajouter/Modifier une Information</h3>
                                <form id="infoForm" class="info-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="infoTitle">Titre de l'information</label>
                                    <input type="text" id="infoTitle" placeholder="Ex: CaliFastDrive ‚Äî Commandes s√©curis√©es" required>
                                </div>
                                <div class="form-group">
                                    <label for="infoIcon">Ic√¥ne (emoji)</label>
                                    <input type="text" id="infoIcon" placeholder="üöÄ" maxlength="2">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="infoSubtitle">Sous-titre</label>
                                <input type="text" id="infoSubtitle" placeholder="Ex: LIVRAISON RAPIDE / ENVOIE MONDIAL RELAY / PRIX IMBATTABLE">
                            </div>
                            
                            <div class="form-group">
                                <label for="infoContent">Contenu de l'information</label>
                                <textarea id="infoContent" rows="8" placeholder="D√©crivez votre service, vos horaires, vos conditions..."></textarea>
                            </div>
                            
                            <!-- Options de personnalisation -->
                            <div class="customization-section">
                                <h4>üé® Options de personnalisation</h4>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="infoTitleColor">Couleur du titre</label>
                                        <input type="color" id="infoTitleColor" value="#ffffff">
                                        <input type="text" id="infoTitleColorHex" placeholder="#ffffff" class="color-hex-input">
                                        <input type="range" id="infoTitleOpacity" min="0" max="1" step="0.1" value="1" class="opacity-slider">
                                        <span class="opacity-value">100%</span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="infoSubtitleColor">Couleur du sous-titre</label>
                                        <input type="color" id="infoSubtitleColor" value="#cccccc">
                                        <input type="text" id="infoSubtitleColorHex" placeholder="#cccccc" class="color-hex-input">
                                        <input type="range" id="infoSubtitleOpacity" min="0" max="1" step="0.1" value="1" class="opacity-slider">
                                        <span class="opacity-value">100%</span>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="infoContentColor">Couleur du contenu</label>
                                        <input type="color" id="infoContentColor" value="#ffffff">
                                        <input type="text" id="infoContentColorHex" placeholder="#ffffff" class="color-hex-input">
                                        <input type="range" id="infoContentOpacity" min="0" max="1" step="0.1" value="1" class="opacity-slider">
                                        <span class="opacity-value">100%</span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="infoBackgroundColor">Couleur de fond</label>
                                        <input type="color" id="infoBackgroundColor" value="#1a1a1a">
                                        <input type="text" id="infoBackgroundColorHex" placeholder="#1a1a1a" class="color-hex-input">
                                        <input type="range" id="infoBackgroundOpacity" min="0" max="1" step="0.1" value="1" class="opacity-slider">
                                        <span class="opacity-value">100%</span>
                                    </div>
                                </div>
                                
                                <!-- Couleurs avanc√©es -->
                                <div class="advanced-colors-section">
                                    <h5>üé® Couleurs avanc√©es</h5>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="infoBorderColor">Couleur de bordure</label>
                                            <input type="color" id="infoBorderColor" value="#333333">
                                            <input type="text" id="infoBorderColorHex" placeholder="#333333" class="color-hex-input">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="infoShadowColor">Couleur d'ombre</label>
                                            <input type="color" id="infoShadowColor" value="#000000">
                                            <input type="text" id="infoShadowColorHex" placeholder="#000000" class="color-hex-input">
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="infoGradientStart">D√©grad√© - Couleur de d√©but</label>
                                            <input type="color" id="infoGradientStart" value="#ff6b6b">
                                            <input type="text" id="infoGradientStartHex" placeholder="#ff6b6b" class="color-hex-input">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="infoGradientEnd">D√©grad√© - Couleur de fin</label>
                                            <input type="color" id="infoGradientEnd" value="#4ecdc4">
                                            <input type="text" id="infoGradientEndHex" placeholder="#4ecdc4" class="color-hex-input">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="infoGradientDirection">Direction du d√©grad√©</label>
                                        <select id="infoGradientDirection">
                                            <option value="to right">Vers la droite</option>
                                            <option value="to left">Vers la gauche</option>
                                            <option value="to bottom">Vers le bas</option>
                                            <option value="to top">Vers le haut</option>
                                            <option value="45deg">Diagonale 45¬∞</option>
                                            <option value="135deg">Diagonale 135¬∞</option>
                                            <option value="225deg">Diagonale 225¬∞</option>
                                            <option value="315deg">Diagonale 315¬∞</option>
                                            <option value="radial">Radial (cercle)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="infoTitleSize">Taille du titre</label>
                                        <select id="infoTitleSize">
                                            <option value="small">Petit</option>
                                            <option value="medium" selected>Moyen</option>
                                            <option value="large">Grand</option>
                                            <option value="xlarge">Tr√®s grand</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="infoTextAlign">Alignement du texte</label>
                                        <select id="infoTextAlign">
                                            <option value="left">Gauche</option>
                                            <option value="center" selected>Centre</option>
                                            <option value="right">Droite</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="infoEffects">Effets visuels de base</label>
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoGradient">
                                            <span class="checkmark"></span>
                                            D√©grad√© de couleur
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoShadow">
                                            <span class="checkmark"></span>
                                            Ombre port√©e
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoGlow">
                                            <span class="checkmark"></span>
                                            Effet de lueur
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoBorder">
                                            <span class="checkmark"></span>
                                            Bordure anim√©e
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoPulse">
                                            <span class="checkmark"></span>
                                            Effet de pulsation
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoShake">
                                            <span class="checkmark"></span>
                                            Effet de tremblement
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Effets avanc√©s -->
                                <div class="advanced-effects-section">
                                    <h5>‚ú® Effets avanc√©s</h5>
                                    
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoGlassmorphism">
                                            <span class="checkmark"></span>
                                            Effet verre (Glassmorphism)
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoNeon">
                                            <span class="checkmark"></span>
                                            Effet n√©on
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoHologram">
                                            <span class="checkmark"></span>
                                            Effet hologramme
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoMatrix">
                                            <span class="checkmark"></span>
                                            Effet Matrix (code qui tombe)
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoParticle">
                                            <span class="checkmark"></span>
                                            Particules flottantes
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoMorphing">
                                            <span class="checkmark"></span>
                                            Effet de morphing
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoGlitch">
                                            <span class="checkmark"></span>
                                            Effet glitch
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoLiquid">
                                            <span class="checkmark"></span>
                                            Effet liquide
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoFire">
                                            <span class="checkmark"></span>
                                            Effet de feu
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoElectric">
                                            <span class="checkmark"></span>
                                            Effet √©lectrique
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="infoRainbow">
                                            <span class="checkmark"></span>
                                            Arc-en-ciel anim√©
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="info3D">
                                            <span class="checkmark"></span>
                                            Effet 3D
                                        </label>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="infoBlurIntensity">Intensit√© du flou</label>
                                            <input type="range" id="infoBlurIntensity" min="0" max="20" value="0" class="effect-slider">
                                            <span class="effect-value">0px</span>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="infoBrightness">Luminosit√©</label>
                                            <input type="range" id="infoBrightness" min="0" max="200" value="100" class="effect-slider">
                                            <span class="effect-value">100%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="infoContrast">Contraste</label>
                                            <input type="range" id="infoContrast" min="0" max="200" value="100" class="effect-slider">
                                            <span class="effect-value">100%</span>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="infoSaturation">Saturation</label>
                                            <input type="range" id="infoSaturation" min="0" max="200" value="100" class="effect-slider">
                                            <span class="effect-value">100%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="infoAnimationType">Type d'animation</label>
                                    <select id="infoAnimationType">
                                        <option value="none">Aucune animation</option>
                                        <option value="fadeIn">Fondu d'apparition</option>
                                        <option value="slideUp">Glissement vers le haut</option>
                                        <option value="slideDown">Glissement vers le bas</option>
                                        <option value="slideLeft">Glissement vers la gauche</option>
                                        <option value="slideRight">Glissement vers la droite</option>
                                        <option value="zoomIn">Zoom d'entr√©e</option>
                                        <option value="zoomOut">Zoom de sortie</option>
                                        <option value="rotateIn">Rotation d'entr√©e</option>
                                        <option value="bounceIn">Rebond d'entr√©e</option>
                                        <option value="flipIn">Retournement d'entr√©e</option>
                                        <option value="typewriter">Effet machine √† √©crire</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="infoHoverEffect">Effet au survol</label>
                                    <select id="infoHoverEffect">
                                        <option value="none">Aucun effet</option>
                                        <option value="scale">Agrandissement</option>
                                        <option value="lift">√âl√©vation</option>
                                        <option value="glow">Lueur au survol</option>
                                        <option value="rotate">Rotation</option>
                                        <option value="shake">Tremblement</option>
                                        <option value="pulse">Pulsation</option>
                                        <option value="colorChange">Changement de couleur</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="infoCustomCSS">CSS personnalis√© (optionnel)</label>
                                    <textarea id="infoCustomCSS" rows="4" placeholder="Ajoutez du CSS personnalis√© pour des effets avanc√©s..."></textarea>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="infoStatus">Statut</label>
                                <select id="infoStatus">
                                    <option value="active">Actif</option>
                                    <option value="inactive">Inactif</option>
                                </select>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="clearInfoForm()">
                                    <span class="btn-icon">üóëÔ∏è</span>
                                    Effacer
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-icon">üíæ</span>
                                    Sauvegarder
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="previewTab" class="tab-content">
                        <h3>üëÅÔ∏è Aper√ßu en temps r√©el</h3>
                        <div class="preview-container">
                            <div class="preview-controls">
                                <button type="button" class="btn btn-secondary" onclick="refreshPreview()">
                                    <span class="btn-icon">üîÑ</span>
                                    Actualiser
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="togglePreviewMode()">
                                    <span class="btn-icon">üì±</span>
                                    <span id="previewModeText">Mode mobile</span>
                                </button>
                            </div>
                            <div class="preview-wrapper">
                                <div id="livePreview" class="live-preview">
                                    <div class="preview-placeholder">
                                        <p>Modifiez les options pour voir l'aper√ßu en temps r√©el</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liste des informations existantes -->
                    <div class="info-list-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>üìã Informations existantes</h3>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary" onclick="reloadInfoItems()" style="padding: 6px 12px; font-size: 12px;">
                                    <span class="btn-icon">üîÑ</span>
                                    Recharger
                                </button>
                            </div>
                        </div>
                        <div id="infoList" class="info-list">
                            <!-- Les informations seront charg√©es ici -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Messages de Commande -->
        <section id="command-messages-section" class="admin-section">
            <div class="section-header">
                <h2>üí¨ Messages de Commande</h2>
                <p>Personnalisez les messages de commande envoy√©s aux clients</p>
            </div>
            <div class="section-content">
                <div class="command-messages-management">
                    <!-- Onglets pour la gestion des messages -->
                    <div class="form-tabs">
                        <button type="button" class="tab-button active" onclick="switchCommandTab('templates')">
                            <span class="tab-icon">üìù</span>
                            <span class="tab-text">Templates</span>
                        </button>
                        <button type="button" class="tab-button" onclick="switchCommandTab('preview')">
                            <span class="tab-icon">üëÅÔ∏è</span>
                            <span class="tab-text">Aper√ßu</span>
                        </button>
                        <button type="button" class="tab-button" onclick="switchCommandTab('settings')">
                            <span class="tab-icon">‚öôÔ∏è</span>
                            <span class="tab-text">Param√®tres</span>
                        </button>
                    </div>

                    <!-- Onglet Templates -->
                    <div id="templatesTab" class="tab-content active">
                        <div class="templates-header">
                            <h3>üìù Gestion des Templates de Messages</h3>
                            <button class="btn btn-primary" onclick="openMessageTemplateModal()">
                                <span class="btn-icon">‚ûï</span>
                                Nouveau Template
                            </button>
                        </div>
                        
                        <div class="templates-list" id="templatesList">
                            <!-- Les templates seront charg√©s dynamiquement -->
                        </div>
                    </div>

                    <!-- Onglet Aper√ßu -->
                    <div id="previewTab" class="tab-content">
                        <h3>üëÅÔ∏è Aper√ßu des Messages</h3>
                        <div class="preview-container">
                            <div class="preview-controls">
                                <label for="previewTemplate">Template √† pr√©visualiser :</label>
                                <select id="previewTemplate" onchange="updatePreview()">
                                    <option value="">S√©lectionnez un template</option>
                                </select>
                            </div>
                            <div class="message-preview" id="messagePreview">
                                <div class="preview-placeholder">
                                    <p>üëÜ S√©lectionnez un template pour voir l'aper√ßu</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Param√®tres -->
                    <div id="settingsTab" class="tab-content">
                        <h3>‚öôÔ∏è Param√®tres des Messages</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="defaultAppName">Nom de l'application par d√©faut :</label>
                                <input type="text" id="defaultAppName" value="CALI FAST DRIVE" placeholder="Nom de l'app">
                            </div>
                            <div class="form-group">
                                <label for="defaultCurrency">Devise par d√©faut :</label>
                                <select id="defaultCurrency">
                                    <option value="‚Ç¨">Euro (‚Ç¨)</option>
                                    <option value="$">Dollar ($)</option>
                                    <option value="¬£">Livre (¬£)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="autoActivate">Activer automatiquement les nouveaux templates :</label>
                                <input type="checkbox" id="autoActivate" checked>
                            </div>
                            <button class="btn btn-primary" onclick="saveMessageSettings()">
                                <span class="btn-icon">üíæ</span>
                                Sauvegarder les param√®tres
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modal Ajout/Modification d'Article -->
    <div id="articleModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ajouter un Article</h3>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            
            <form id="articleForm" onsubmit="saveArticle(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="articleName">Nom de l'article *</label>
                        <input type="text" id="articleName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="articleCategory">Cat√©gorie *</label>
                        <select id="articleCategory" name="category" required>
                            <option value="">S√©lectionner une cat√©gorie</option>
                            <option value="stup">STUP</option>
                            <option value="tabac">TABAC</option>
                            <option value="puffs">PUFFS</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="articleDescription">Description</label>
                    <textarea id="articleDescription" name="description" rows="3"></textarea>
                </div>


                <div class="form-row">
                    <div class="form-group">
                        <label for="articleStatus">Statut</label>
                        <select id="articleStatus" name="status">
                            <option value="active">Actif</option>
                            <option value="inactive">Inactif</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleFeatured">Mise en avant</label>
                        <select id="articleFeatured" name="featured">
                            <option value="false">Non</option>
                            <option value="true">Oui</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="articleStockStatus">Statut de Stock</label>
                    <select id="articleStockStatus" name="stock_status" required>
                        <option value="in_stock">EN STOCK</option>
                        <option value="out_of_stock">RUPTURE DE STOCK</option>
                    </select>
                </div>




                <!-- Zone de Drag & Drop pour l'image/vid√©o -->
                <div class="form-group">
                    <label>Image/Vid√©o de l'article *</label>
                    <div class="media-upload-zone" id="mediaUploadZone">
                        <div class="upload-content">
                            <span class="upload-icon">üì∑</span>
                            <p>Glissez-d√©posez une image ou vid√©o ici</p>
                            <p class="upload-hint">Formats accept√©s: JPG, PNG, GIF, MP4, WEBM, MOV, AVI, MKV</p>
                        </div>
                        <input type="file" id="mediaInput" accept="image/*,video/*" style="display: none;">
                    </div>
                    <div class="media-preview" id="mediaPreview" style="display: none;">
                        <div class="preview-container">
                            <img id="previewImg" src="" alt="Aper√ßu" style="display: none; max-width: 200px; max-height: 200px; border-radius: 8px;">
                            <video id="previewVideo" src="" controls style="display: none; max-width: 200px; max-height: 200px; border-radius: 8px;"></video>
                            <button type="button" class="remove-media" id="removeMedia">‚úï</button>
                        </div>
                    </div>
                </div>

                <!-- Gestion des variantes de prix -->
                <div class="form-group">
                    <label>Variantes de prix</label>
                    <div class="price-variants-container" id="priceVariantsContainer">
                        <div class="variant-item">
                            <input type="text" placeholder="Quantit√© (ex: 5g)" class="variant-quantity" name="variant_quantity[]">
                            <input type="number" placeholder="Prix" step="0.01" class="variant-price" name="variant_price[]">
                            <button type="button" class="remove-variant" onclick="removeVariant(this)">‚úï</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addVariant()" style="margin-top: 10px;">
                        + Ajouter une variante
                    </button>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span>
                        Enregistrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmation de Suppression -->
    <div id="deleteModal" class="modal" style="display: none;">
        <div class="modal-content small">
            <div class="modal-header">
                <h3>Confirmer la suppression</h3>
                <button class="modal-close" onclick="closeDeleteModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p>√ätes-vous s√ªr de vouloir supprimer cet article ?</p>
                <p class="warning-text">Cette action est irr√©versible.</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Annuler</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- Modal Template de Message -->
    <div id="messageTemplateModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="messageModalTitle">Nouveau Template de Message</h3>
                <button class="modal-close" onclick="closeMessageTemplateModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="messageTemplateForm" class="message-template-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="templateName">Nom du template *</label>
                            <input type="text" id="templateName" required placeholder="Ex: Template Standard">
                        </div>
                        <div class="form-group">
                            <label for="templateDescription">Description</label>
                            <input type="text" id="templateDescription" placeholder="Description du template">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="messageTemplate">Template du message *</label>
                        <textarea id="messageTemplate" rows="8" required placeholder="Utilisez les variables disponibles..."></textarea>
                        <div class="template-help">
                            <p><strong>Variables disponibles :</strong></p>
                            <div class="variables-list">
                                <span class="variable-tag" onclick="insertVariable('{product_name}')">{product_name}</span>
                                <span class="variable-tag" onclick="insertVariable('{product_quantity}')">{product_quantity}</span>
                                <span class="variable-tag" onclick="insertVariable('{product_price}')">{product_price}</span>
                                <span class="variable-tag" onclick="insertVariable('{total_price}')">{total_price}</span>
                                <span class="variable-tag" onclick="insertVariable('{app_name}')">{app_name}</span>
                                <span class="variable-tag" onclick="insertVariable('{product_list}')">{product_list}</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="headerText">Texte d'en-t√™te</label>
                            <input type="text" id="headerText" value="üõí COMMANDE" placeholder="üõí COMMANDE">
                        </div>
                        <div class="form-group">
                            <label for="headerEmoji">Emoji d'en-t√™te</label>
                            <input type="text" id="headerEmoji" value="üõí" placeholder="üõí">
                        </div>
                    </div>

                    <!-- Section Personnalisation -->
                    <div class="customization-section">
                        <h4>üé® Personnalisation</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="textColor">Couleur du texte</label>
                                <input type="color" id="textColor" value="#ffffff">
                            </div>
                            <div class="form-group">
                                <label for="backgroundColor">Couleur de fond</label>
                                <input type="color" id="backgroundColor" value="#1a1a1a">
                            </div>
                            <div class="form-group">
                                <label for="borderColor">Couleur de bordure</label>
                                <input type="color" id="borderColor" value="#333333">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="fontFamily">Police</label>
                                <select id="fontFamily">
                                    <option value="Inter">Inter</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Helvetica">Helvetica</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fontSize">Taille de police</label>
                                <input type="number" id="fontSize" value="14" min="8" max="24">
                            </div>
                            <div class="form-group">
                                <label for="textAlign">Alignement</label>
                                <select id="textAlign">
                                    <option value="left">Gauche</option>
                                    <option value="center">Centre</option>
                                    <option value="right">Droite</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="showEmoji" checked>
                                    Afficher les emojis
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="showBorder">
                                    Afficher la bordure
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="showShadow" checked>
                                    Afficher l'ombre
                                </label>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="gradientBackground">
                                    Fond d√©grad√©
                                </label>
                            </div>
                        </div>

                        <div class="form-row" id="gradientSettings" style="display: none;">
                            <div class="form-group">
                                <label for="gradientStart">Couleur de d√©but</label>
                                <input type="color" id="gradientStart" value="#ff6b6b">
                            </div>
                            <div class="form-group">
                                <label for="gradientEnd">Couleur de fin</label>
                                <input type="color" id="gradientEnd" value="#4ecdc4">
                            </div>
                        </div>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="isActive" checked>
                            Activer ce template
                        </label>
                    </div>
                </form>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeMessageTemplateModal()">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="saveMessageTemplate()">
                    <span class="btn-icon">üíæ</span>
                    Sauvegarder
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Chargement...</p>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications-container"></div>

    <!-- Cloudinary Configuration -->
    <script src="cloudinary-config.js"></script>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Command Messages Manager -->
    <script src="command-messages.js"></script>

    <script>
        // Configuration Supabase
        const SUPABASE_URL = 'https://aapicehoqxdwixbiqucs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhcGljZWhvcXhkd2l4YmlxdWNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzE5ODMsImV4cCI6MjA3MzAwNzk4M30.jBTeUfGBkVT0-5ElCD1NM6fCQCD7wnRpw4I2ulykLOQ';

        // Variables globales
        let articles = [];
        let filteredArticles = [];
        let currentArticle = null;
        let deleteArticleId = null;
        let selectedMediaFile = null;
        let isLoggedIn = false;

        // Configuration de connexion
        const ADMIN_PASSWORD = 'ocbrita';

        // Fonction de connexion
        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            // Debug: afficher les valeurs pour diagnostiquer
            console.log('üîç Debug connexion:');
            console.log('Mot de passe saisi:', `"${password}"`);
            console.log('Longueur:', password.length);
            console.log('Mot de passe attendu:', `"${ADMIN_PASSWORD}"`);
            console.log('Longueur attendue:', ADMIN_PASSWORD.length);
            console.log('√âgalit√© exacte:', password === ADMIN_PASSWORD);
            console.log('√âgalit√© sans espaces:', password.trim() === ADMIN_PASSWORD);
            
            if (password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                saveSession(); // Sauvegarder la session
                showNotification('‚úÖ Connexion r√©ussie !', 'success');
                
                // Masquer la page de connexion et afficher le panel admin
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                
                // Charger les articles et informations
                loadArticles();
                loadInfoItems();
            } else {
                // Essayer aussi sans espaces au cas o√π
                if (password.trim() === ADMIN_PASSWORD) {
                    console.log('‚úÖ Connexion r√©ussie avec trim()');
                    isLoggedIn = true;
                    saveSession();
                    showNotification('‚úÖ Connexion r√©ussie !', 'success');
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    loadArticles();
                    loadInfoItems();
                } else {
                    showNotification(`‚ùå Mot de passe incorrect. Saisi: "${password}" (${password.length} caract√®res)`, 'error');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
                }
            }
        }

        // Fonction de d√©connexion
        function logout() {
            isLoggedIn = false;
            sessionStorage.removeItem('adminLoggedIn'); // Effacer la session
            showNotification('üëã D√©connexion r√©ussie', 'info');
            
            // Masquer le panel admin et afficher la page de connexion
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
            
            // Vider le champ de mot de passe
            document.getElementById('adminPassword').value = '';
        }

        // V√©rifier la session au chargement
        function checkSession() {
            // V√©rifier si l'utilisateur est d√©j√† connect√© (session storage)
            const session = sessionStorage.getItem('adminLoggedIn');
            if (session === 'true') {
                isLoggedIn = true;
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadArticles();
            }
        }

        // Sauvegarder la session
        function saveSession() {
            sessionStorage.setItem('adminLoggedIn', 'true');
        }

        // Fonction pour charger les articles
        async function loadArticles() {
            const grid = document.getElementById('articlesGrid');
            const loading = document.getElementById('loadingOverlay');
            
            loading.style.display = 'flex';

            try {
                console.log('üîÑ Chargement des articles depuis Supabase...');
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/articles?select=*&order=created_at.desc`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status} ${response.statusText}`);
                }

                articles = await response.json();
                filteredArticles = [...articles];
                console.log(`‚úÖ ${articles.length} articles charg√©s:`, articles);
                
                // Debug pour voir les vid√©os
                articles.forEach(article => {
                    if (article.image_url && (article.image_url.includes('.mp4') || article.image_url.includes('.webm') || article.image_url.includes('.mov'))) {
                        console.log(`üé• Article avec vid√©o: ${article.name} - ${article.image_url}`);
                    }
                    
                });

                displayArticles();

            } catch (error) {
                console.error('‚ùå Erreur lors du chargement des articles:', error);
                grid.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #dc3545;">
                        <h3>‚ùå Erreur de chargement</h3>
                        <p>${error.message}</p>
                        <button onclick="loadArticles()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            R√©essayer
                        </button>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        }

        // Fonction pour normaliser l'affichage des images et vid√©os
        function normalizeImageDisplay() {
            const images = document.querySelectorAll('.article-image');
            images.forEach(img => {
                if (img.tagName === 'IMG') {
                    // Forcer le style pour toutes les images
                    img.style.objectFit = 'cover';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.borderRadius = '12px';
                    img.style.background = 'var(--bg-secondary)';
                    
                    // G√©rer les erreurs d'image
                    img.onerror = function() {
                        this.style.display = 'none';
                        const fallback = this.nextElementSibling;
                        if (fallback && fallback.classList.contains('image-fallback')) {
                            fallback.style.display = 'flex';
                        }
                    };
                } else if (img.tagName === 'VIDEO') {
                    // Optimiser les vid√©os pour mobile
                    img.setAttribute('playsinline', 'true');
                    img.setAttribute('webkit-playsinline', 'true');
                    img.setAttribute('preload', 'metadata');
                    
                    // Forcer le style pour les vid√©os
                    img.style.objectFit = 'cover';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.borderRadius = '12px';
                    
                    // G√©rer les erreurs de vid√©o
                    img.onerror = function() {
                        this.style.display = 'none';
                        const fallback = this.nextElementSibling;
                        if (fallback && fallback.classList.contains('video-fallback')) {
                            fallback.style.display = 'flex';
                        }
                    };
                    
                    // Forcer le chargement sur mobile
                    if (isMobile()) {
                        img.load();
                    }
                }
            });
        }

        // Fonction pour d√©tecter si on est sur mobile
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Fonction pour supprimer l'article probl√©matique "Alice au Pays des Merveilles"
        async function removeProblematicArticle() {
            try {
                // Chercher l'article probl√©matique
                const problematicArticle = articles.find(article => 
                    article.name.toLowerCase().includes('alice') || 
                    article.name.toLowerCase().includes('pays des merveilles') ||
                    article.name.toLowerCase().includes('wonderland')
                );

                if (problematicArticle) {
                    console.log('üóëÔ∏è Suppression de l\'article probl√©matique:', problematicArticle.name);
                    
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/articles?id=eq.${problematicArticle.id}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        console.log('‚úÖ Article probl√©matique supprim√© avec succ√®s');
                        showNotification('Article probl√©matique supprim√© !', 'success');
                        loadArticles(); // Recharger la liste
                    } else {
                        console.error('‚ùå Erreur lors de la suppression:', response.status);
                    }
                } else {
                    console.log('‚ÑπÔ∏è Aucun article probl√©matique trouv√©');
                }
            } catch (error) {
                console.error('‚ùå Erreur lors de la suppression de l\'article probl√©matique:', error);
            }
        }

        // Fonction pour afficher les articles
        function displayArticles() {
            const grid = document.getElementById('articlesGrid');
            
            if (filteredArticles.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 20px;"><p>üì≠ Aucun article trouv√©</p></div>';
                return;
            }

            grid.innerHTML = filteredArticles.map(article => {
                // Debug pour voir les images
                console.log(`üñºÔ∏è Article: ${article.name}, Image URL: ${article.image_url}`);
                
                // Afficher seulement les 3 premi√®res variantes de prix
                const priceVariants = article.price_variants || [];
                const visibleVariants = priceVariants.slice(0, 3);
                const remainingCount = Math.max(0, priceVariants.length - 3);
                
                return `
                    <div class="article-card">
                        <div class="article-image-container">
                            ${article.image_url ? 
                                (article.image_url.startsWith('data:image/') ? 
                                    // Image base64
                                    `<img src="${article.image_url}" alt="${article.name}" class="article-image" style="object-fit: cover; width: 100%; height: 100%; border-radius: 12px;">` :
                                    (article.image_url.startsWith('data:video/') || 
                                     article.image_url.startsWith('blob:') ||
                                     article.image_url.includes('.mp4') || 
                                     article.image_url.includes('.webm') || 
                                     article.image_url.includes('.mov') || 
                                     article.image_url.includes('.avi') || 
                                     article.image_url.includes('.mkv') ? 
                                        `<video class="article-image" controls muted preload="metadata" playsinline webkit-playsinline onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                            <source src="${article.image_url}" type="video/mp4">
                                            <source src="${article.image_url}" type="video/webm">
                                            Votre navigateur ne supporte pas la lecture de vid√©os.
                                        </video>
                                        <div class="video-fallback" style="display: none; align-items: center; justify-content: center; height: 100%; background: var(--bg-secondary); color: var(--text-muted); font-size: 48px; flex-direction: column;">
                                            <div>üé•</div>
                                            <div style="font-size: 12px; margin-top: 8px;">Vid√©o non disponible</div>
                                        </div>
                                        <div class="video-indicator">üé•</div>` :
                                        `<img src="${article.image_url}" alt="${article.name}" class="article-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" style="object-fit: cover; width: 100%; height: 100%; border-radius: 12px;">`
                                    )
                                ) : 
                                `<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: var(--bg-secondary); color: var(--text-muted); font-size: 48px;">üì¶</div>`
                            }
                            <div class="image-fallback" style="display: none; align-items: center; justify-content: center; height: 100%; background: var(--bg-secondary); color: var(--text-muted); font-size: 48px; flex-direction: column;">
                                <div>üì¶</div>
                                <div style="font-size: 12px; margin-top: 8px;">Image non disponible</div>
                            </div>
                            <div class="article-badge ${article.stock > 0 ? 'in-stock' : 'out-of-stock'}">${article.stock > 0 ? 'EN STOCK' : 'RUPTURE DE STOCK'}</div>
                        </div>
                        <div class="article-content">
                            <h3 class="article-title">${article.name}</h3>
                            <p class="article-description">${article.description || 'Aucune description'}</p>
                            <span class="article-category category-${article.category}">${article.category.toUpperCase()}</span>
                            
                            <div class="price-variants">
                                ${visibleVariants.map(variant => `
                                    <div class="price-variant">
                                        <span class="variant-quantity">${variant.quantity}</span>
                                        <span class="variant-price">${variant.price.toFixed(2)}‚Ç¨</span>
                                    </div>
                                `).join('')}
                                ${remainingCount > 0 ? `<div class="more-variants">+${remainingCount} autres</div>` : ''}
                            </div>
                            
                            <div class="article-stock-info">
                                <span class="stock-label">Stock total: ${article.stock}</span>
                            </div>
                            
                            <div class="article-actions">
                                <button class="btn-edit" onclick="editArticle(${article.id})">
                                    ‚úèÔ∏è Modifier
                                </button>
                                <button class="btn-delete" onclick="deleteArticle(${article.id})">
                                    üóëÔ∏è Supprimer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Normaliser l'affichage des images apr√®s le rendu
            setTimeout(() => {
                normalizeImageDisplay();
            }, 100);
        }

        // Fonction pour filtrer les articles
        function filterArticles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredArticles = articles.filter(article => {
                const matchesSearch = article.name.toLowerCase().includes(searchTerm) || 
                                    (article.description && article.description.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || article.category === categoryFilter;
                const matchesStatus = !statusFilter || article.status === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            displayArticles();
        }



        // Fonction pour basculer entre les sections
        function switchSection(section) {
            // Masquer toutes les sections
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Afficher la section s√©lectionn√©e
            const targetSection = document.getElementById(section + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Activer l'onglet correspondant
            const targetNav = document.querySelector(`[onclick="switchSection('${section}')"]`);
            if (targetNav) {
                targetNav.classList.add('active');
            }

            // Actions sp√©cifiques par section
            if (section === 'command-messages' && commandMessageManager) {
                commandMessageManager.loadTemplates();
            }
        }

        // Fonction pour ouvrir le modal d'ajout
        function openAddModal() {
            currentArticle = null;
            selectedMediaFile = null;
            document.getElementById('modalTitle').textContent = 'Ajouter un Article';
            document.getElementById('articleForm').reset();
            resetMediaUpload();
            resetPriceVariants();
            document.getElementById('articleModal').style.display = 'flex';
            setupMediaUpload();
        }

        // Fonction pour modifier un article
        function editArticle(id) {
            currentArticle = articles.find(a => a.id === id);
            if (!currentArticle) return;

            selectedMediaFile = null;
            document.getElementById('modalTitle').textContent = 'Modifier l\'Article';
            document.getElementById('articleName').value = currentArticle.name;
            document.getElementById('articleCategory').value = currentArticle.category;
            document.getElementById('articleDescription').value = currentArticle.description || '';
            // D√©finir le statut de stock bas√© sur la valeur stock
            const stockStatus = (currentArticle.stock > 0) ? 'in_stock' : 'out_of_stock';
            document.getElementById('articleStockStatus').value = stockStatus;
            document.getElementById('articleStatus').value = currentArticle.status;
            document.getElementById('articleFeatured').value = currentArticle.featured.toString();
            
            // Charger les variantes de prix
            loadPriceVariants(currentArticle.price_variants || []);
            
            // Charger l'image/vid√©o existante
            if (currentArticle.image_url) {
                loadExistingMedia(currentArticle.image_url);
            } else {
                resetMediaUpload();
            }
            
            document.getElementById('articleModal').style.display = 'flex';
            setupMediaUpload();
        }

        // Fonction pour sauvegarder l'article dans la base de donn√©es
        async function saveArticleToDatabase(articleData) {
            const loading = document.getElementById('loadingOverlay');
            loading.style.display = 'flex';

            try {
                let response;

                if (currentArticle) {
                    // Modification d'un article existant
                    response = await fetch(`${SUPABASE_URL}/rest/v1/articles?id=eq.${currentArticle.id}`, {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify(articleData)
                    });
                } else {
                    // Cr√©ation d'un nouvel article
                    response = await fetch(`${SUPABASE_URL}/rest/v1/articles`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify([articleData])
                    });
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Erreur de sauvegarde:', response.status, errorText);
                    throw new Error(`Erreur: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                console.log('‚úÖ Article sauvegard√© avec succ√®s:', result);
                console.log('üîç Image URL sauvegard√©e:', result[0]?.image_url);

                showNotification(currentArticle ? 'Article modifi√© avec succ√®s !' : 'Article ajout√© avec succ√®s !', 'success');
                closeModal();
                loadArticles();

            } catch (error) {
                console.error('‚ùå Erreur lors de la sauvegarde:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Fonction pour sauvegarder un article dans la base de donn√©es
        async function saveArticleToDatabase(articleData) {
            const loading = document.getElementById('loadingOverlay');
            loading.style.display = 'flex';

            try {
                let response;
                
                if (currentArticle) {
                    // Modification d'un article existant
                    response = await fetch(`${SUPABASE_URL}/rest/v1/articles?id=eq.${currentArticle.id}`, {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify(articleData)
                    });
                } else {
                    // Cr√©ation d'un nouvel article
                    response = await fetch(`${SUPABASE_URL}/rest/v1/articles`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify([articleData])
                    });
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå Erreur de sauvegarde:', response.status, errorText);
                    throw new Error(`Erreur: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                console.log('‚úÖ Article sauvegard√© avec succ√®s:', result);
                console.log('üîç Image URL sauvegard√©e:', result[0]?.image_url);

                showNotification(currentArticle ? 'Article modifi√© avec succ√®s !' : 'Article ajout√© avec succ√®s !', 'success');
                closeModal();
                loadArticles();

            } catch (error) {
                console.error('‚ùå Erreur lors de la sauvegarde:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Fonction pour sauvegarder un article
        async function saveArticle(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const stockStatus = formData.get('stock_status');
            
            // R√©cup√©rer les variantes de prix
            const priceVariants = getPriceVariants();
            
            // Calculer le prix principal (prix minimum des variantes)
            const mainPrice = priceVariants.length > 0 ? Math.min(...priceVariants.map(v => v.price)) : 0;
            
            // Convertir le statut de stock en valeur num√©rique pour la base de donn√©es
            const stock = stockStatus === 'in_stock' ? 1 : 0;
            
            const articleData = {
                name: formData.get('name'),
                category: formData.get('category'),
                description: formData.get('description'),
                price: mainPrice, // Prix principal calcul√© automatiquement
                stock: stock,
                status: formData.get('status'),
                featured: formData.get('featured') === 'true',
                image_url: currentArticle ? currentArticle.image_url : null, // Garder l'URL existante lors de la modification
                price_variants: priceVariants
            };

            console.log('üîç Donn√©es de l\'article avant traitement image:', articleData);
            console.log('üîç Fichier s√©lectionn√©:', selectedMediaFile);

            // G√©rer l'upload de fichier si un nouveau fichier est s√©lectionn√©
            if (selectedMediaFile) {
                try {
                    // Cr√©er un nom de fichier unique
                    const fileExtension = selectedMediaFile.name.split('.').pop();
                    const fileName = `article_${Date.now()}.${fileExtension}`;
                    
                    // V√©rifier si c'est une vid√©o
                    const isVideo = selectedMediaFile.type.startsWith('video/') || 
                                   fileName.match(/\.(mp4|webm|ogg|mov|avi|mkv)$/i);
                    
                    if (isVideo) {
                        // Pour les vid√©os, v√©rifier la taille (limite Cloudinary: 100MB)
                        const maxVideoSize = 100 * 1024 * 1024; // 100MB max avec Cloudinary
                        
                        if (selectedMediaFile.size > maxVideoSize) {
                            showNotification('‚ö†Ô∏è Vid√©o trop volumineuse (max 100MB)', 'error');
                            return;
                        }
                        
                        // Option 2: Cloudinary Storage pour les vid√©os (NOUVELLE - jusqu'√† 100 Mo)
                        try {
                            showNotification('üé• Upload de la vid√©o vers Cloudinary...', 'info');
                            const videoUrl = await uploadToCloudinary(selectedMediaFile, fileName);
                            articleData.image_url = videoUrl;
                            
                            console.log('üé• Vid√©o upload√©e vers Cloudinary:', fileName, 'URL:', videoUrl);
                            
                            // Sauvegarder l'article avec l'URL de la vid√©o
                                await saveArticleToDatabase(articleData);
                        } catch (error) {
                            console.error('Erreur lors de l\'upload de la vid√©o vers Cloudinary:', error);
                            showNotification('Erreur lors de l\'upload de la vid√©o: ' + error.message, 'error');
                            return;
                        }
                    } else {
                        // Option 2: Cloudinary Storage pour les images (NOUVELLE - jusqu'√† 100 Mo)
                        try {
                            showNotification('üñºÔ∏è Upload de l\'image vers Cloudinary...', 'info');
                            const imageUrl = await uploadToCloudinary(selectedMediaFile, fileName);
                            articleData.image_url = imageUrl;
                            
                            console.log('üñºÔ∏è Image upload√©e vers Cloudinary:', fileName, 'URL:', imageUrl);
                            
                            // Sauvegarder l'article avec l'URL de l'image
                            await saveArticleToDatabase(articleData);
                        } catch (error) {
                            console.error('Erreur lors de l\'upload de l\'image vers Cloudinary:', error);
                            showNotification('Erreur lors de l\'upload de l\'image: ' + error.message, 'error');
                            return;
                        }
                    }
                    
                } catch (error) {
                    console.error('Erreur lors de la gestion du fichier:', error);
                    showNotification('Erreur lors de l\'upload du fichier', 'error');
                    return;
                }
            } else if (!currentArticle) {
                // Si c'est un nouvel article et qu'aucun fichier n'est s√©lectionn√©, mettre une image par d√©faut
                articleData.image_url = null;
            }

            // Sauvegarder l'article (sans fichier ou avec fichier d√©j√† trait√©)
            await saveArticleToDatabase(articleData);
        }

        // Fonction pour supprimer un article
        function deleteArticle(id) {
            deleteArticleId = id;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        // Fonction pour confirmer la suppression
        async function confirmDelete() {
            if (!deleteArticleId) return;

            const loading = document.getElementById('loadingOverlay');
            loading.style.display = 'flex';

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/articles?id=eq.${deleteArticleId}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erreur: ${response.status} - ${errorText}`);
                }

                showNotification('Article supprim√© avec succ√®s !', 'success');
                closeDeleteModal();
                loadArticles();

            } catch (error) {
                console.error('‚ùå Erreur lors de la suppression:', error);
                showNotification('Erreur lors de la suppression: ' + error.message, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Fonction pour fermer le modal
        function closeModal() {
            document.getElementById('articleModal').style.display = 'none';
        }

        // Fonction pour fermer le modal de suppression
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteArticleId = null;
        }

        // Fonction pour afficher les notifications
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            container.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ===== FONCTIONS DRAG & DROP =====
        
        function setupMediaUpload() {
            const uploadZone = document.getElementById('mediaUploadZone');
            const mediaInput = document.getElementById('mediaInput');
            const removeMedia = document.getElementById('removeMedia');

            // Reset des √©v√©nements
            uploadZone.replaceWith(uploadZone.cloneNode(true));
            const newUploadZone = document.getElementById('mediaUploadZone');
            const newMediaInput = document.getElementById('mediaInput');
            const newRemoveMedia = document.getElementById('removeMedia');

            // Clic sur la zone
            newUploadZone.addEventListener('click', () => newMediaInput.click());

            // Drag & Drop
            newUploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                newUploadZone.classList.add('dragover');
            });

            newUploadZone.addEventListener('dragleave', () => {
                newUploadZone.classList.remove('dragover');
            });

            newUploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                newUploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleMediaFile(files[0]);
                }
            });

            // S√©lection de fichier
            newMediaInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleMediaFile(e.target.files[0]);
                }
            });

            // Suppression
            newRemoveMedia.addEventListener('click', () => {
                resetMediaUpload();
            });
        }

        function handleMediaFile(file) {
            // V√©rification de taille supprim√©e - aucune limite

            // V√©rifier le type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/webm', 'video/quicktime', 'video/x-msvideo', 'video/x-matroska'];
            if (!validTypes.includes(file.type)) {
                showNotification('Format de fichier non support√©', 'error');
                return;
            }

            selectedMediaFile = file;
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImg');
            const previewVideo = document.getElementById('previewVideo');
            const uploadZone = document.getElementById('mediaUploadZone');

            uploadZone.style.display = 'none';
            preview.style.display = 'block';

            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                    previewVideo.style.display = 'none';
                };
                reader.readAsDataURL(file);
            } else if (file.type.startsWith('video/')) {
                const url = URL.createObjectURL(file);
                previewVideo.src = url;
                previewVideo.style.display = 'block';
                previewImg.style.display = 'none';
            }
            
            showNotification('Fichier s√©lectionn√© avec succ√®s !', 'success');
        }

        function resetMediaUpload() {
            const uploadZone = document.getElementById('mediaUploadZone');
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImg');
            const previewVideo = document.getElementById('previewVideo');
            const mediaInput = document.getElementById('mediaInput');

            uploadZone.style.display = 'block';
            preview.style.display = 'none';
            previewImg.style.display = 'none';
            previewVideo.style.display = 'none';
            previewImg.src = '';
            previewVideo.src = '';
            mediaInput.value = '';
            selectedMediaFile = null;
        }

        // Fonction pour compresser les images
        async function compressImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                img.onload = () => {
                    // Calculer les nouvelles dimensions (max 800px pour r√©duire la taille)
                    const maxWidth = 800;
                    const maxHeight = 800;
                    let { width, height } = img;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Dessiner l'image redimensionn√©e
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convertir en blob avec compression
                    canvas.toBlob((blob) => {
                        if (blob) {
                            console.log(`üñºÔ∏è Image compress√©e: ${file.size} ‚Üí ${blob.size} bytes`);
                            resolve(blob);
                        } else {
                            reject(new Error('Erreur lors de la compression'));
                        }
                    }, 'image/jpeg', 0.8); // Qualit√© 80%
                };
                
                img.onerror = () => reject(new Error('Erreur lors du chargement de l\'image'));
                img.src = URL.createObjectURL(file);
            });
        }

        // Fonction pour compresser les vid√©os
        async function compressVideo(file) {
            return new Promise((resolve, reject) => {
                // Pour les vid√©os, on va simplement limiter la taille et utiliser une compression basique
                // Si la vid√©o est trop grande, on la redimensionne
                const maxSize = 50 * 1024 * 1024; // 50MB max pour la compression (Cloudinary accepte jusqu'√† 100MB)
                
                if (file.size <= maxSize) {
                    // Si la vid√©o est d√©j√† assez petite, on la retourne telle quelle
                    console.log(`üìπ Vid√©o d√©j√† optimis√©e: ${file.size} bytes`);
                    resolve(file);
                    return;
                }
                
                // Si la vid√©o est trop grande, on essaie de la compresser
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                video.onloadedmetadata = () => {
                    // Calculer les nouvelles dimensions (max 360p pour r√©duire la taille)
                    const maxWidth = 360;
                    const maxHeight = 360;
                    let { videoWidth, videoHeight } = video;
                    
                    if (videoWidth > maxWidth || videoHeight > maxHeight) {
                        const ratio = Math.min(maxWidth / videoWidth, maxHeight / videoHeight);
                        videoWidth *= ratio;
                        videoHeight *= ratio;
                    }
                    
                    canvas.width = videoWidth;
                    canvas.height = videoHeight;
                    
                    video.oncanplay = () => {
                        // Dessiner la vid√©o sur le canvas
                        ctx.drawImage(video, 0, 0, videoWidth, videoHeight);
                        
                        // Convertir en blob avec compression
                        canvas.toBlob((blob) => {
                            if (blob) {
                                console.log(`üìπ Vid√©o compress√©e: ${file.size} ‚Üí ${blob.size} bytes`);
                                resolve(blob);
                            } else {
                                // Si la compression √©choue, on retourne le fichier original
                                console.log('‚ö†Ô∏è Compression √©chou√©e, utilisation du fichier original');
                                resolve(file);
                            }
                        }, 'image/jpeg', 0.6); // Utiliser JPEG pour les frames
                    };
                    
                    video.play();
                };
                
                video.onerror = () => {
                    console.log('‚ö†Ô∏è Erreur de compression, utilisation du fichier original');
                    resolve(file);
                };
                
                video.src = URL.createObjectURL(file);
            });
        }

        function loadExistingMedia(url) {
            console.log('üñºÔ∏è Chargement du m√©dia existant:', url);
            const preview = document.getElementById('mediaPreview');
            const previewImg = document.getElementById('previewImg');
            const previewVideo = document.getElementById('previewVideo');
            const uploadZone = document.getElementById('mediaUploadZone');

            uploadZone.style.display = 'none';
            preview.style.display = 'block';

            // V√©rifier si c'est une URL base64 (image)
            if (url.startsWith('data:image/')) {
                console.log('üñºÔ∏è Chargement image base64');
                previewImg.src = url;
                previewImg.style.display = 'block';
                previewVideo.style.display = 'none';
            } else if (url.startsWith('data:video/')) {
                console.log('üé• Chargement vid√©o base64');
                console.log('üé• Taille des donn√©es:', url.length);
                console.log('üé• Type MIME:', url.substring(5, url.indexOf(';')));
                previewVideo.src = url;
                previewVideo.style.display = 'block';
                previewImg.style.display = 'none';
                
                // Ajouter des attributs pour la lecture vid√©o
                previewVideo.setAttribute('controls', 'true');
                previewVideo.setAttribute('playsinline', 'true');
                previewVideo.setAttribute('webkit-playsinline', 'true');
                previewVideo.setAttribute('preload', 'metadata');
                
                // V√©rifier si la vid√©o se charge correctement
                previewVideo.onerror = function() {
                    console.log('‚ùå Erreur de chargement de la vid√©o base64');
                    previewVideo.style.display = 'none';
                    previewImg.style.display = 'block';
                    previewImg.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkFmZmljaGFnZSB2aWRlbyBpbXBvc3NpYmxlPC90ZXh0Pjwvc3ZnPg==';
                };
            } else if (url.match(/\.(mp4|webm|ogg|mov|avi|mkv)$/i) || url.startsWith('blob:')) {
                console.log('üé• Chargement vid√©o:', url);
                previewVideo.src = url;
                previewVideo.style.display = 'block';
                previewImg.style.display = 'none';
            } else {
                console.log('üñºÔ∏è Chargement image:', url);
                previewImg.src = url;
                previewImg.style.display = 'block';
                previewVideo.style.display = 'none';
            }
        }

        // ===== FONCTIONS GESTION DU M√âDIA =====
        
        // ===== FONCTIONS CLOUDINARY =====
        // Les fonctions uploadToCloudinary et deleteFromCloudinary sont d√©finies dans cloudinary-config.js

        // ===== FONCTIONS GESTION DES INFORMATIONS =====
        
        // Variables globales pour les informations
        let infoItems = [];
        let currentInfoId = null;
        
        // Initialiser le client Supabase pour les informations
        let supabaseClient;
        try {
            const { createClient } = supabase;
            supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Client Supabase initialis√©');
        } catch (error) {
            console.error('‚ùå Erreur initialisation Supabase:', error);
            showNotification('‚ö†Ô∏è Erreur de connexion √† Supabase', 'warning');
        }

        // Charger les informations au d√©marrage
        async function loadInfoItems() {
            try {
                console.log('üîÑ Chargement des informations depuis Supabase...');
                
                // V√©rifier que le client Supabase est disponible
                if (!supabaseClient) {
                    throw new Error('Client Supabase non initialis√©');
                }
                
                // Charger depuis Supabase
                const { data, error } = await supabaseClient
                    .from('informations')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Erreur Supabase:', error);
                    
                    // Si la table n'existe pas, cr√©er les donn√©es d'exemple et les ins√©rer
                    if (error.code === 'PGRST116' || error.message.includes('relation "informations" does not exist')) {
                        console.log('üìù Table informations non trouv√©e, cr√©ation des donn√©es d\'exemple...');
                        await createInitialData();
                        return;
                    } else {
                        throw error;
                    }
                } else {
                    infoItems = data || [];
                    console.log('‚úÖ Informations charg√©es depuis Supabase:', infoItems.length);
                    
                    // Si aucune donn√©e, cr√©er les donn√©es d'exemple
                    if (infoItems.length === 0) {
                        console.log('üìù Aucune donn√©e trouv√©e, cr√©ation des donn√©es d\'exemple...');
                        await createInitialData();
                        return;
                    }
                }
                
                console.log('üìã Donn√©es √† afficher:', infoItems);
                displayInfoItems();
            } catch (error) {
                console.error('Erreur lors du chargement des informations:', error);
                showNotification('Erreur lors du chargement des informations', 'error');
            }
        }

        // Cr√©er les donn√©es initiales dans Supabase
        async function createInitialData() {
            const initialData = [
                {
                    title: "CaliFastDrive ‚Äî Commandes s√©curis√©es et flexibles",
                    icon: "üöÄ",
                    subtitle: "LIVRAISON RAPIDE / ENVOIE MONDIAL RELAY / PRIX IMBATTABLE",
                    content: `**Envoie Colis** üì¶
‚Ä¢ Prise de commande : 10h √† 00h 7/7j
‚Ä¢ **Information : ouvert tous les jours de 10h √† 00h** ‚ñ≤
‚Ä¢ V√©rification d'identit√©
‚Ä¢ Modes de paiement : CASH, BTC

**Pour un traitement rapide, veuillez fournir :**
‚Ä¢ V√©rification d'identit√© (nouveaux clients)
‚Ä¢ L'adresse de livraison compl√®te
‚Ä¢ Vos disponibilit√©s pour la r√©ception
‚Ä¢ Les d√©tails de votre commande

**FAS - Meet-Up** üß° **(Indisponible)**
Ce service n'est pas disponible pour le moment ‚õî`,
                    status: "active"
                }
            ];

            try {
                showNotification('üîÑ Cr√©ation des donn√©es initiales...', 'info');
                
                const { data, error } = await supabaseClient
                    .from('informations')
                    .insert(initialData)
                    .select();

                if (error) {
                    console.error('Erreur lors de la cr√©ation des donn√©es:', error);
                    showNotification('‚ùå Erreur lors de la cr√©ation des donn√©es: ' + error.message, 'error');
                    
                    // Fallback sur les donn√©es locales
                    infoItems = initialData.map((item, index) => ({
                        ...item,
                        id: index + 1,
                        created_at: new Date().toISOString()
                    }));
                    displayInfoItems();
                } else {
                    console.log('‚úÖ Donn√©es initiales cr√©√©es:', data);
                    showNotification('‚úÖ Donn√©es initiales cr√©√©es avec succ√®s !', 'success');
                    
                    infoItems = data || [];
                    displayInfoItems();
                }
            } catch (error) {
                console.error('Erreur lors de la cr√©ation des donn√©es:', error);
                showNotification('‚ùå Erreur lors de la cr√©ation des donn√©es: ' + error.message, 'error');
                
                // Fallback sur les donn√©es locales
                infoItems = initialData.map((item, index) => ({
                    ...item,
                    id: index + 1,
                    created_at: new Date().toISOString()
                }));
                displayInfoItems();
            }
        }

        // Fonction pour recharger les informations depuis Supabase
        function reloadInfoItems() {
            console.log('üîÑ Rechargement des informations...');
            loadInfoItems();
        }

        // Afficher les informations dans la liste
        function displayInfoItems() {
            console.log('üîÑ Affichage des informations:', infoItems);
            const infoList = document.getElementById('infoList');
            if (!infoList) {
                console.error('‚ùå √âl√©ment infoList non trouv√©');
                return;
            }

            if (infoItems.length === 0) {
                console.log('‚ö†Ô∏è Aucune information √† afficher');
                infoList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Aucune information trouv√©e</p>';
                return;
            }

            console.log('‚úÖ G√©n√©ration de', infoItems.length, '√©l√©ments d\'information');
            infoList.innerHTML = infoItems.map(info => `
                <div class="info-item">
                    <div class="info-item-header">
                        <div class="info-item-title">
                            <span>${info.icon}</span>
                            ${info.title}
                        </div>
                        <span class="info-item-status ${info.status}">${info.status === 'active' ? 'Actif' : 'Inactif'}</span>
                    </div>
                    ${info.subtitle ? `<div class="info-item-subtitle">${info.subtitle}</div>` : ''}
                    <div class="info-item-content">${info.content.substring(0, 150)}${info.content.length > 150 ? '...' : ''}</div>
                    <div class="info-item-actions">
                        <button class="btn btn-secondary" onclick="editInfo(${info.id})">
                            <span class="btn-icon">‚úèÔ∏è</span>
                            Modifier
                        </button>
                        <button class="btn btn-danger" onclick="deleteInfo(${info.id})">
                            <span class="btn-icon">üóëÔ∏è</span>
                            Supprimer
                        </button>
                    </div>
                </div>
            `).join('');
            
            console.log('‚úÖ Informations affich√©es dans le DOM');
        }

        // Modifier une information
        function editInfo(id) {
            const info = infoItems.find(item => item.id === id);
            if (!info) return;

            currentInfoId = id;
            
            // Remplir le formulaire
            document.getElementById('infoTitle').value = info.title;
            document.getElementById('infoIcon').value = info.icon;
            document.getElementById('infoSubtitle').value = info.subtitle || '';
            document.getElementById('infoContent').value = info.content;
            document.getElementById('infoStatus').value = info.status;
            
            // Charger les options de personnalisation
            document.getElementById('infoTitleColor').value = info.title_color || '#ffffff';
            document.getElementById('infoSubtitleColor').value = info.subtitle_color || '#cccccc';
            document.getElementById('infoContentColor').value = info.content_color || '#ffffff';
            document.getElementById('infoBackgroundColor').value = info.background_color || '#1a1a1a';
            document.getElementById('infoTitleSize').value = info.title_size || 'medium';
            document.getElementById('infoTextAlign').value = info.text_align || 'center';
            document.getElementById('infoCustomCSS').value = info.custom_css || '';
            
            // Charger les effets
            document.getElementById('infoGradient').checked = info.gradient_effect || false;
            document.getElementById('infoShadow').checked = info.shadow_effect || false;
            document.getElementById('infoGlow').checked = info.glow_effect || false;
            document.getElementById('infoBorder').checked = info.border_effect || false;
            document.getElementById('infoPulse').checked = info.pulse_effect || false;
            document.getElementById('infoShake').checked = info.shake_effect || false;
            
            // Charger les animations
            document.getElementById('infoAnimationType').value = info.animation_type || 'none';
            document.getElementById('infoHoverEffect').value = info.hover_effect || 'none';

            // Faire d√©filer vers le formulaire
            document.querySelector('.info-form-container').scrollIntoView({ behavior: 'smooth' });
            
            showNotification('Information charg√©e pour modification', 'info');
        }

        // Supprimer une information
        async function deleteInfo(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette information ?')) {
                try {
                    console.log('üîÑ Suppression de l\'information:', id);
                    
                    // Supprimer de Supabase
                    const { error } = await supabaseClient
                        .from('informations')
                        .delete()
                        .eq('id', id);
                    
                    if (error) {
                        console.error('Erreur Supabase (suppression):', error);
                        showNotification('Erreur lors de la suppression: ' + error.message, 'error');
                        return;
                    }
                    
                    // Supprimer de la liste locale
                    infoItems = infoItems.filter(item => item.id !== id);
                    displayInfoItems();
                    showNotification('Information supprim√©e avec succ√®s', 'success');
                    
                } catch (error) {
                    console.error('Erreur lors de la suppression:', error);
                    showNotification('Erreur lors de la suppression: ' + error.message, 'error');
                }
            }
        }

        // Effacer le formulaire
        function clearInfoForm() {
            document.getElementById('infoForm').reset();
            currentInfoId = null;
            
            // R√©initialiser les valeurs par d√©faut des options de personnalisation
            document.getElementById('infoTitleColor').value = '#ffffff';
            document.getElementById('infoSubtitleColor').value = '#cccccc';
            document.getElementById('infoContentColor').value = '#ffffff';
            document.getElementById('infoBackgroundColor').value = '#1a1a1a';
            document.getElementById('infoTitleSize').value = 'medium';
            document.getElementById('infoTextAlign').value = 'center';
            document.getElementById('infoCustomCSS').value = '';
            document.getElementById('infoAnimationType').value = 'none';
            document.getElementById('infoHoverEffect').value = 'none';
            
            // D√©cocher toutes les cases d'effets
            document.getElementById('infoGradient').checked = false;
            document.getElementById('infoShadow').checked = false;
            document.getElementById('infoGlow').checked = false;
            document.getElementById('infoBorder').checked = false;
            document.getElementById('infoPulse').checked = false;
            document.getElementById('infoShake').checked = false;
            
            showNotification('Formulaire effac√©', 'info');
        }

        // Sauvegarder une information
        async function saveInfo(infoData) {
            try {
                if (currentInfoId) {
                    // Modification dans Supabase
                    console.log('üîÑ Modification de l\'information:', currentInfoId);
                    console.log('üìù Donn√©es √† envoyer:', infoData);
                    
                    const { data, error } = await supabaseClient
                        .from('informations')
                        .update(infoData)
                        .eq('id', currentInfoId)
                        .select();
                    
                    if (error) {
                        console.error('Erreur Supabase (modification):', error);
                        console.error('D√©tails de l\'erreur:', error.message, error.details, error.hint);
                        showNotification('Erreur lors de la modification: ' + error.message, 'error');
                        return;
                    }
                    
                    // Mettre √† jour la liste locale
                    const index = infoItems.findIndex(item => item.id === currentInfoId);
                    if (index !== -1) {
                        infoItems[index] = { ...infoItems[index], ...infoData, updated_at: new Date().toISOString() };
                    }
                    
                    showNotification('Information modifi√©e avec succ√®s', 'success');
                } else {
                    // Nouvelle information dans Supabase
                    console.log('üîÑ Ajout d\'une nouvelle information');
                    const { data, error } = await supabaseClient
                        .from('informations')
                        .insert([infoData])
                        .select();
                    
                    if (error) {
                        console.error('Erreur Supabase (ajout):', error);
                        showNotification('Erreur lors de l\'ajout: ' + error.message, 'error');
                        return;
                    }
                    
                    // Ajouter √† la liste locale
                    if (data && data.length > 0) {
                        infoItems.unshift(data[0]);
                    }
                    
                    showNotification('Information ajout√©e avec succ√®s', 'success');
                }
                
                displayInfoItems();
                clearInfoForm();
                
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
            }
        }

        // Gestionnaire du formulaire d'informations
        document.addEventListener('DOMContentLoaded', function() {
            const infoForm = document.getElementById('infoForm');
            if (infoForm) {
                
                // Gestionnaires pour les sliders d'opacit√©
                setupOpacitySliders();
                
                // Gestionnaires pour les sliders d'effets
                setupEffectSliders();
                
                // Gestionnaires pour les champs de couleur hex
                setupColorHexInputs();
                
                // Configuration de la pr√©visualisation en temps r√©el
                setupPreviewAutoUpdate();
                infoForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        title: document.getElementById('infoTitle').value.trim(),
                        icon: document.getElementById('infoIcon').value.trim() || '‚ÑπÔ∏è',
                        subtitle: document.getElementById('infoSubtitle').value.trim(),
                        content: document.getElementById('infoContent').value.trim(),
                        status: document.getElementById('infoStatus').value,
                        
                        // Options de personnalisation de base
                        title_color: document.getElementById('infoTitleColorHex').value || document.getElementById('infoTitleColor').value,
                        subtitle_color: document.getElementById('infoSubtitleColorHex').value || document.getElementById('infoSubtitleColor').value,
                        content_color: document.getElementById('infoContentColorHex').value || document.getElementById('infoContentColor').value,
                        background_color: document.getElementById('infoBackgroundColorHex').value || document.getElementById('infoBackgroundColor').value,
                        title_size: document.getElementById('infoTitleSize').value,
                        text_align: document.getElementById('infoTextAlign').value,
                        custom_css: document.getElementById('infoCustomCSS').value.trim(),
                        
                        // Couleurs avanc√©es
                        border_color: document.getElementById('infoBorderColorHex').value || document.getElementById('infoBorderColor').value,
                        shadow_color: document.getElementById('infoShadowColorHex').value || document.getElementById('infoShadowColor').value,
                        gradient_start: document.getElementById('infoGradientStartHex').value || document.getElementById('infoGradientStart').value,
                        gradient_end: document.getElementById('infoGradientEndHex').value || document.getElementById('infoGradientEnd').value,
                        gradient_direction: document.getElementById('infoGradientDirection').value,
                        
                        // Effets visuels de base
                        gradient_effect: document.getElementById('infoGradient').checked,
                        shadow_effect: document.getElementById('infoShadow').checked,
                        glow_effect: document.getElementById('infoGlow').checked,
                        border_effect: document.getElementById('infoBorder').checked,
                        pulse_effect: document.getElementById('infoPulse').checked,
                        shake_effect: document.getElementById('infoShake').checked,
                        
                        // Effets avanc√©s
                        glassmorphism_effect: document.getElementById('infoGlassmorphism').checked,
                        neon_effect: document.getElementById('infoNeon').checked,
                        hologram_effect: document.getElementById('infoHologram').checked,
                        matrix_effect: document.getElementById('infoMatrix').checked,
                        particle_effect: document.getElementById('infoParticle').checked,
                        morphing_effect: document.getElementById('infoMorphing').checked,
                        glitch_effect: document.getElementById('infoGlitch').checked,
                        liquid_effect: document.getElementById('infoLiquid').checked,
                        fire_effect: document.getElementById('infoFire').checked,
                        electric_effect: document.getElementById('infoElectric').checked,
                        rainbow_effect: document.getElementById('infoRainbow').checked,
                        effect_3d: document.getElementById('info3D').checked,
                        
                        // Param√®tres d'effets
                        blur_intensity: document.getElementById('infoBlurIntensity').value,
                        brightness: document.getElementById('infoBrightness').value,
                        contrast: document.getElementById('infoContrast').value,
                        saturation: document.getElementById('infoSaturation').value,
                        
                        // Animations
                        animation_type: document.getElementById('infoAnimationType').value,
                        hover_effect: document.getElementById('infoHoverEffect').value
                    };
                    
                    if (!formData.title || !formData.content) {
                        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                        return;
                    }
                    
                    await saveInfo(formData);
                });
            }
        });

        // Configuration des sliders d'opacit√©
        function setupOpacitySliders() {
            const opacitySliders = [
                { slider: 'infoTitleOpacity', color: 'infoTitleColor', hex: 'infoTitleColorHex', value: 'infoTitleOpacityValue' },
                { slider: 'infoSubtitleOpacity', color: 'infoSubtitleColor', hex: 'infoSubtitleColorHex', value: 'infoSubtitleOpacityValue' },
                { slider: 'infoContentOpacity', color: 'infoContentColor', hex: 'infoContentColorHex', value: 'infoContentOpacityValue' },
                { slider: 'infoBackgroundOpacity', color: 'infoBackgroundColor', hex: 'infoBackgroundColorHex', value: 'infoBackgroundOpacityValue' }
            ];

            opacitySliders.forEach(({ slider, color, hex, value }) => {
                const sliderEl = document.getElementById(slider);
                const colorEl = document.getElementById(color);
                const hexEl = document.getElementById(hex);
                const valueEl = document.querySelector(`#${slider} + .opacity-value`);

                if (sliderEl && colorEl && hexEl && valueEl) {
                    // Mise √† jour de l'opacit√© quand le slider change
                    sliderEl.addEventListener('input', function() {
                        const opacity = this.value;
                        const colorValue = colorEl.value;
                        const rgbaColor = hexToRgba(colorValue, opacity);
                        hexEl.value = rgbaColor;
                        valueEl.textContent = Math.round(opacity * 100) + '%';
                    });

                    // Mise √† jour du slider quand la couleur change
                    colorEl.addEventListener('input', function() {
                        const opacity = sliderEl.value;
                        const rgbaColor = hexToRgba(this.value, opacity);
                        hexEl.value = rgbaColor;
                    });

                    // Mise √† jour depuis le champ hex
                    hexEl.addEventListener('input', function() {
                        const rgbaMatch = this.value.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);
                        if (rgbaMatch) {
                            const opacity = rgbaMatch[4] || 1;
                            sliderEl.value = opacity;
                            valueEl.textContent = Math.round(opacity * 100) + '%';
                        }
                    });
                }
            });
        }

        // Configuration des sliders d'effets
        function setupEffectSliders() {
            const effectSliders = [
                { slider: 'infoBlurIntensity', value: 'infoBlurIntensityValue', unit: 'px' },
                { slider: 'infoBrightness', value: 'infoBrightnessValue', unit: '%' },
                { slider: 'infoContrast', value: 'infoContrastValue', unit: '%' },
                { slider: 'infoSaturation', value: 'infoSaturationValue', unit: '%' }
            ];

            effectSliders.forEach(({ slider, value, unit }) => {
                const sliderEl = document.getElementById(slider);
                const valueEl = document.querySelector(`#${slider} + .effect-value`);

                if (sliderEl && valueEl) {
                    sliderEl.addEventListener('input', function() {
                        valueEl.textContent = this.value + unit;
                    });
                }
            });
        }

        // Configuration des champs de couleur hex
        function setupColorHexInputs() {
            const colorPairs = [
                { color: 'infoTitleColor', hex: 'infoTitleColorHex' },
                { color: 'infoSubtitleColor', hex: 'infoSubtitleColorHex' },
                { color: 'infoContentColor', hex: 'infoContentColorHex' },
                { color: 'infoBackgroundColor', hex: 'infoBackgroundColorHex' },
                { color: 'infoBorderColor', hex: 'infoBorderColorHex' },
                { color: 'infoShadowColor', hex: 'infoShadowColorHex' },
                { color: 'infoGradientStart', hex: 'infoGradientStartHex' },
                { color: 'infoGradientEnd', hex: 'infoGradientEndHex' }
            ];

            colorPairs.forEach(({ color, hex }) => {
                const colorEl = document.getElementById(color);
                const hexEl = document.getElementById(hex);

                if (colorEl && hexEl) {
                    // Synchroniser couleur -> hex
                    colorEl.addEventListener('input', function() {
                        hexEl.value = this.value;
                    });

                    // Synchroniser hex -> couleur
                    hexEl.addEventListener('input', function() {
                        if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                            colorEl.value = this.value;
                        }
                    });
                }
            });
        }

        // Fonction utilitaire pour convertir hex en rgba
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Gestion des onglets
        function switchTab(tabName) {
            // Masquer tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les boutons d'onglets
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Afficher l'onglet s√©lectionn√©
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Activer le bouton correspondant
            event.target.closest('.tab-button').classList.add('active');
            
            // Si c'est l'onglet de pr√©visualisation, actualiser l'aper√ßu
            if (tabName === 'preview') {
                setTimeout(() => {
                    refreshPreview();
                }, 100); // Petit d√©lai pour s'assurer que l'onglet est visible
            }
        }

        // Variables pour la pr√©visualisation
        let previewMode = 'desktop'; // 'desktop' ou 'mobile'
        let previewUpdateTimeout;

        // Actualiser la pr√©visualisation
        function refreshPreview() {
            const previewContainer = document.getElementById('livePreview');
            if (!previewContainer) return;

            // R√©cup√©rer les valeurs du formulaire
            const formData = getFormData();
            
            // G√©n√©rer le HTML de pr√©visualisation
            const previewHTML = generatePreviewHTML(formData);
            
            // Appliquer les styles
            const previewStyles = generatePreviewStyles(formData);
            
            // Mettre √† jour l'aper√ßu
            previewContainer.innerHTML = previewHTML;
            
            // Appliquer les styles
            applyPreviewStyles(previewStyles);
        }

        // R√©cup√©rer les donn√©es du formulaire
        function getFormData() {
            return {
                title: document.getElementById('infoTitle').value || 'Titre de l\'information',
                icon: document.getElementById('infoIcon').value || '‚ÑπÔ∏è',
                subtitle: document.getElementById('infoSubtitle').value || 'Sous-titre de l\'information',
                content: document.getElementById('infoContent').value || 'Contenu de l\'information...',
                
                // Couleurs
                title_color: document.getElementById('infoTitleColorHex').value || document.getElementById('infoTitleColor').value || '#ffffff',
                subtitle_color: document.getElementById('infoSubtitleColorHex').value || document.getElementById('infoSubtitleColor').value || '#cccccc',
                content_color: document.getElementById('infoContentColorHex').value || document.getElementById('infoContentColor').value || '#ffffff',
                background_color: document.getElementById('infoBackgroundColorHex').value || document.getElementById('infoBackgroundColor').value || '#1a1a1a',
                
                // Couleurs avanc√©es
                border_color: document.getElementById('infoBorderColorHex').value || document.getElementById('infoBorderColor').value || '#333333',
                shadow_color: document.getElementById('infoShadowColorHex').value || document.getElementById('infoShadowColor').value || '#000000',
                gradient_start: document.getElementById('infoGradientStartHex').value || document.getElementById('infoGradientStart').value || '#ff6b6b',
                gradient_end: document.getElementById('infoGradientEndHex').value || document.getElementById('infoGradientEnd').value || '#4ecdc4',
                gradient_direction: document.getElementById('infoGradientDirection').value || '45deg',
                
                // Taille et alignement
                title_size: document.getElementById('infoTitleSize').value || 'medium',
                text_align: document.getElementById('infoTextAlign').value || 'center',
                
                // Effets
                gradient_effect: document.getElementById('infoGradient').checked,
                shadow_effect: document.getElementById('infoShadow').checked,
                glow_effect: document.getElementById('infoGlow').checked,
                border_effect: document.getElementById('infoBorder').checked,
                pulse_effect: document.getElementById('infoPulse').checked,
                shake_effect: document.getElementById('infoShake').checked,
                
                // Effets avanc√©s
                glassmorphism_effect: document.getElementById('infoGlassmorphism').checked,
                neon_effect: document.getElementById('infoNeon').checked,
                hologram_effect: document.getElementById('infoHologram').checked,
                matrix_effect: document.getElementById('infoMatrix').checked,
                particle_effect: document.getElementById('infoParticle').checked,
                morphing_effect: document.getElementById('infoMorphing').checked,
                glitch_effect: document.getElementById('infoGlitch').checked,
                liquid_effect: document.getElementById('infoLiquid').checked,
                fire_effect: document.getElementById('infoFire').checked,
                electric_effect: document.getElementById('infoElectric').checked,
                rainbow_effect: document.getElementById('infoRainbow').checked,
                effect_3d: document.getElementById('info3D').checked,
                
                // Param√®tres d'effets
                blur_intensity: document.getElementById('infoBlurIntensity').value || 0,
                brightness: document.getElementById('infoBrightness').value || 100,
                contrast: document.getElementById('infoContrast').value || 100,
                saturation: document.getElementById('infoSaturation').value || 100,
                
                // Animations
                animation_type: document.getElementById('infoAnimationType').value || 'none',
                hover_effect: document.getElementById('infoHoverEffect').value || 'none',
                
                // CSS personnalis√©
                custom_css: document.getElementById('infoCustomCSS').value || ''
            };
        }

        // G√©n√©rer le HTML de pr√©visualisation
        function generatePreviewHTML(data) {
            const content = data.content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>')
                .replace(/‚Ä¢/g, '&bull;');

            return `
                <div class="info-card preview-card" id="previewCard">
                    <div class="info-header">
                        <h2 class="custom-title">${data.icon} ${data.title}</h2>
                        ${data.subtitle ? `<p class="info-subtitle custom-subtitle">${data.subtitle}</p>` : ''}
                    </div>
                    <div class="info-content-text custom-content">
                        ${content}
                    </div>
                </div>
            `;
        }

        // G√©n√©rer les styles de pr√©visualisation
        function generatePreviewStyles(data) {
            let styles = '';
            const cardId = '#previewCard';
            
            // Couleurs de base
            if (data.title_color) {
                styles += `${cardId} .custom-title { color: ${data.title_color} !important; }\n`;
            }
            if (data.subtitle_color) {
                styles += `${cardId} .custom-subtitle { color: ${data.subtitle_color} !important; }\n`;
            }
            if (data.content_color) {
                styles += `${cardId} .custom-content { color: ${data.content_color} !important; }\n`;
            }
            if (data.background_color) {
                styles += `${cardId} { background: ${data.background_color} !important; }\n`;
            }
            
            // Taille du titre
            if (data.title_size) {
                const sizes = {
                    'small': '1.5rem',
                    'medium': '2rem',
                    'large': '2.5rem',
                    'xlarge': '3rem'
                };
                styles += `${cardId} .custom-title { font-size: ${sizes[data.title_size] || '2rem'} !important; }\n`;
            }
            
            // Alignement
            if (data.text_align) {
                styles += `${cardId} { text-align: ${data.text_align} !important; }\n`;
            }
            
            // Effets (r√©utiliser la logique de generateCustomStyles)
            if (data.gradient_effect) {
                const gradientDirection = data.gradient_direction || '45deg';
                if (gradientDirection === 'radial') {
                    styles += `${cardId} .custom-title { 
                        background: radial-gradient(circle, ${data.gradient_start}, ${data.gradient_end});
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }\n`;
                } else {
                    styles += `${cardId} .custom-title { 
                        background: linear-gradient(${gradientDirection}, ${data.gradient_start}, ${data.gradient_end});
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }\n`;
                }
            }
            
            if (data.shadow_effect) {
                styles += `${cardId} { 
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
                }\n`;
            }
            
            if (data.glow_effect) {
                styles += `${cardId} { 
                    box-shadow: 0 0 20px ${data.title_color}40 !important;
                }\n`;
            }
            
            // Effets de base suppl√©mentaires
            if (data.border_effect) {
                styles += `${cardId} { 
                    border: 2px solid ${data.border_color || data.title_color || '#ffffff'} !important;
                    animation: borderGlow 2s ease-in-out infinite alternate !important;
                }\n`;
                styles += `@keyframes borderGlow {
                    from { border-color: ${data.border_color || data.title_color || '#ffffff'}; }
                    to { border-color: #ff6b6b; }
                }\n`;
            }
            
            if (data.pulse_effect) {
                styles += `${cardId} { 
                    animation: pulse 2s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }\n`;
            }
            
            if (data.shake_effect) {
                styles += `${cardId} { 
                    animation: shake 0.5s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    25% { transform: translateX(-5px); }
                    75% { transform: translateX(5px); }
                }\n`;
            }
            
            // Effets avanc√©s complets
            if (data.glassmorphism_effect) {
                styles += `${cardId} { 
                    background: rgba(255, 255, 255, 0.1) !important;
                    backdrop-filter: blur(10px) !important;
                    border: 1px solid rgba(255, 255, 255, 0.2) !important;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
                }\n`;
            }
            
            if (data.neon_effect) {
                styles += `${cardId} { 
                    text-shadow: 0 0 5px ${data.title_color || '#ffffff'}, 
                                 0 0 10px ${data.title_color || '#ffffff'}, 
                                 0 0 15px ${data.title_color || '#ffffff'}, 
                                 0 0 20px ${data.title_color || '#ffffff'} !important;
                    box-shadow: 0 0 20px ${data.title_color || '#ffffff'}40 !important;
                }\n`;
            }
            
            if (data.hologram_effect) {
                styles += `${cardId} { 
                    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%) !important;
                    animation: hologram 2s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes hologram {
                    0%, 100% { transform: skewX(0deg) scaleY(1); }
                    50% { transform: skewX(2deg) scaleY(1.02); }
                }\n`;
            }
            
            if (data.matrix_effect) {
                styles += `${cardId}::before { 
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: linear-gradient(90deg, transparent 0%, rgba(0,255,0,0.1) 50%, transparent 100%);
                    animation: matrix 3s linear infinite !important;
                    pointer-events: none;
                }\n`;
                styles += `@keyframes matrix {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }\n`;
            }
            
            if (data.particle_effect) {
                styles += `${cardId}::after { 
                    content: '‚ú¶ ‚úß ‚ú¶ ‚úß ‚ú¶';
                    position: absolute;
                    top: -20px;
                    left: 0;
                    right: 0;
                    color: ${data.title_color || '#ffffff'};
                    font-size: 12px;
                    animation: particles 4s ease-in-out infinite !important;
                    pointer-events: none;
                }\n`;
                styles += `@keyframes particles {
                    0%, 100% { opacity: 0; transform: translateY(0); }
                    50% { opacity: 1; transform: translateY(-10px); }
                }\n`;
            }
            
            if (data.morphing_effect) {
                styles += `${cardId} { 
                    animation: morphing 3s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes morphing {
                    0%, 100% { border-radius: 8px; }
                    25% { border-radius: 50% 8px 8px 50%; }
                    50% { border-radius: 8px 50% 50% 8px; }
                    75% { border-radius: 50% 50% 8px 8px; }
                }\n`;
            }
            
            if (data.glitch_effect) {
                styles += `${cardId} { 
                    animation: glitch 0.3s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes glitch {
                    0%, 100% { transform: translate(0); }
                    20% { transform: translate(-2px, 2px); }
                    40% { transform: translate(-2px, -2px); }
                    60% { transform: translate(2px, 2px); }
                    80% { transform: translate(2px, -2px); }
                }\n`;
            }
            
            if (data.liquid_effect) {
                styles += `${cardId} { 
                    animation: liquid 4s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes liquid {
                    0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
                    50% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
                }\n`;
            }
            
            if (data.fire_effect) {
                styles += `${cardId} { 
                    background: linear-gradient(45deg, #ff0000, #ff4500, #ffa500, #ffff00) !important;
                    animation: fire 1s ease-in-out infinite alternate !important;
                }\n`;
                styles += `@keyframes fire {
                    0% { filter: hue-rotate(0deg); }
                    100% { filter: hue-rotate(20deg); }
                }\n`;
            }
            
            if (data.electric_effect) {
                styles += `${cardId} { 
                    border: 2px solid ${data.title_color || '#ffffff'} !important;
                    box-shadow: 0 0 10px ${data.title_color || '#ffffff'}, 
                                inset 0 0 10px ${data.title_color || '#ffffff'} !important;
                    animation: electric 0.5s ease-in-out infinite !important;
                }\n`;
                styles += `@keyframes electric {
                    0%, 100% { box-shadow: 0 0 10px ${data.title_color || '#ffffff'}, inset 0 0 10px ${data.title_color || '#ffffff'}; }
                    50% { box-shadow: 0 0 20px ${data.title_color || '#ffffff'}, inset 0 0 20px ${data.title_color || '#ffffff'}; }
                }\n`;
            }
            
            if (data.rainbow_effect) {
                styles += `${cardId} { 
                    background: linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) !important;
                    background-size: 400% 400% !important;
                    animation: rainbow 3s ease infinite !important;
                }\n`;
                styles += `@keyframes rainbow {
                    0% { background-position: 0% 50%; }
                    50% { background-position: 100% 50%; }
                    100% { background-position: 0% 50%; }
                }\n`;
            }
            
            if (data.effect_3d) {
                styles += `${cardId} { 
                    transform: perspective(1000px) rotateX(10deg) rotateY(10deg) !important;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3) !important;
                }\n`;
            }
            
            // Animations d'entr√©e
            if (data.animation_type && data.animation_type !== 'none') {
                const animations = {
                    'fadeIn': 'fadeIn 0.8s ease-out',
                    'slideUp': 'slideUp 0.8s ease-out',
                    'slideDown': 'slideDown 0.8s ease-out',
                    'slideLeft': 'slideLeft 0.8s ease-out',
                    'slideRight': 'slideRight 0.8s ease-out',
                    'zoomIn': 'zoomIn 0.8s ease-out',
                    'zoomOut': 'zoomOut 0.8s ease-out',
                    'rotateIn': 'rotateIn 0.8s ease-out',
                    'bounceIn': 'bounceIn 1s ease-out',
                    'flipIn': 'flipIn 0.8s ease-out',
                    'typewriter': 'typewriter 2s steps(40, end)'
                };
                
                styles += `${cardId} { 
                    animation: ${animations[data.animation_type]} !important;
                }\n`;
                
                // D√©finir les keyframes pour chaque animation
                if (data.animation_type === 'fadeIn') {
                    styles += `@keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }\n`;
                } else if (data.animation_type === 'slideUp') {
                    styles += `@keyframes slideUp {
                        from { opacity: 0; transform: translateY(50px); }
                        to { opacity: 1; transform: translateY(0); }
                    }\n`;
                } else if (data.animation_type === 'slideDown') {
                    styles += `@keyframes slideDown {
                        from { opacity: 0; transform: translateY(-50px); }
                        to { opacity: 1; transform: translateY(0); }
                    }\n`;
                } else if (data.animation_type === 'slideLeft') {
                    styles += `@keyframes slideLeft {
                        from { opacity: 0; transform: translateX(50px); }
                        to { opacity: 1; transform: translateX(0); }
                    }\n`;
                } else if (data.animation_type === 'slideRight') {
                    styles += `@keyframes slideRight {
                        from { opacity: 0; transform: translateX(-50px); }
                        to { opacity: 1; transform: translateX(0); }
                    }\n`;
                } else if (data.animation_type === 'zoomIn') {
                    styles += `@keyframes zoomIn {
                        from { opacity: 0; transform: scale(0.5); }
                        to { opacity: 1; transform: scale(1); }
                    }\n`;
                } else if (data.animation_type === 'zoomOut') {
                    styles += `@keyframes zoomOut {
                        from { opacity: 0; transform: scale(1.5); }
                        to { opacity: 1; transform: scale(1); }
                    }\n`;
                } else if (data.animation_type === 'rotateIn') {
                    styles += `@keyframes rotateIn {
                        from { opacity: 0; transform: rotate(-180deg); }
                        to { opacity: 1; transform: rotate(0deg); }
                    }\n`;
                } else if (data.animation_type === 'bounceIn') {
                    styles += `@keyframes bounceIn {
                        0% { opacity: 0; transform: scale(0.3); }
                        50% { opacity: 1; transform: scale(1.05); }
                        70% { transform: scale(0.9); }
                        100% { opacity: 1; transform: scale(1); }
                    }\n`;
                } else if (data.animation_type === 'flipIn') {
                    styles += `@keyframes flipIn {
                        from { opacity: 0; transform: perspective(400px) rotateY(90deg); }
                        to { opacity: 1; transform: perspective(400px) rotateY(0deg); }
                    }\n`;
                } else if (data.animation_type === 'typewriter') {
                    styles += `${cardId} .custom-title {
                        overflow: hidden;
                        border-right: 2px solid ${data.title_color || '#ffffff'};
                        white-space: nowrap;
                        margin: 0 auto;
                        animation: typewriter 2s steps(40, end), blink-caret 0.75s step-end infinite;
                    }\n`;
                    styles += `@keyframes typewriter {
                        from { width: 0; }
                        to { width: 100%; }
                    }\n`;
                    styles += `@keyframes blink-caret {
                        from, to { border-color: transparent; }
                        50% { border-color: ${data.title_color || '#ffffff'}; }
                    }\n`;
                }
            }
            
            // Effets au survol
            if (data.hover_effect && data.hover_effect !== 'none') {
                const hoverEffects = {
                    'scale': 'transform: scale(1.1);',
                    'lift': 'transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.3);',
                    'glow': `box-shadow: 0 0 30px ${data.title_color || '#ffffff'}60;`,
                    'rotate': 'transform: rotate(5deg);',
                    'shake': 'animation: shake 0.5s ease-in-out;',
                    'pulse': 'animation: pulse 1s ease-in-out;',
                    'colorChange': `background: linear-gradient(45deg, ${data.title_color || '#ffffff'}, #ff6b6b);`
                };
                
                styles += `${cardId}:hover { 
                    transition: all 0.3s ease;
                    ${hoverEffects[data.hover_effect]}
                }\n`;
            }
            
            // Param√®tres d'effets
            if (data.blur_intensity && data.blur_intensity > 0) {
                styles += `${cardId} { filter: blur(${data.blur_intensity}px) !important; }\n`;
            }
            
            if (data.brightness && data.brightness !== 100) {
                styles += `${cardId} { filter: brightness(${data.brightness}%) !important; }\n`;
            }
            
            if (data.contrast && data.contrast !== 100) {
                styles += `${cardId} { filter: contrast(${data.contrast}%) !important; }\n`;
            }
            
            if (data.saturation && data.saturation !== 100) {
                styles += `${cardId} { filter: saturate(${data.saturation}%) !important; }\n`;
            }
            
            // CSS personnalis√©
            if (data.custom_css) {
                styles += `${cardId} { ${data.custom_css} }\n`;
            }
            
            return styles;
        }

        // Appliquer les styles de pr√©visualisation
        function applyPreviewStyles(styles) {
            // Supprimer l'ancien style
            const oldStyle = document.getElementById('previewStyles');
            if (oldStyle) {
                oldStyle.remove();
            }
            
            // Cr√©er et appliquer le nouveau style
            const styleElement = document.createElement('style');
            styleElement.id = 'previewStyles';
            styleElement.textContent = styles;
            document.head.appendChild(styleElement);
        }

        // Basculer le mode de pr√©visualisation
        function togglePreviewMode() {
            const wrapper = document.querySelector('.preview-wrapper');
            const modeText = document.getElementById('previewModeText');
            
            if (previewMode === 'desktop') {
                previewMode = 'mobile';
                wrapper.classList.add('preview-mobile');
                wrapper.classList.remove('preview-desktop');
                modeText.textContent = 'Mode desktop';
            } else {
                previewMode = 'desktop';
                wrapper.classList.add('preview-desktop');
                wrapper.classList.remove('preview-mobile');
                modeText.textContent = 'Mode mobile';
            }
        }

        // Mise √† jour automatique de la pr√©visualisation
        function setupPreviewAutoUpdate() {
            // √âcouter les changements sur tous les champs du formulaire
            const formElements = document.querySelectorAll('#infoForm input, #infoForm select, #infoForm textarea');
            
            formElements.forEach(element => {
                element.addEventListener('input', function() {
                    // D√©lai pour √©viter trop de mises √† jour
                    clearTimeout(previewUpdateTimeout);
                    previewUpdateTimeout = setTimeout(() => {
                        refreshPreview();
                    }, 300);
                });
                
                element.addEventListener('change', function() {
                    refreshPreview();
                });
            });
        }

        // Fonction pour uploader un fichier vers Supabase Storage (ANCIENNE - gard√©e en fallback)
        async function uploadToSupabaseStorage(file, fileName) {
            try {
                // Essayer diff√©rents noms de buckets courants
                const possibleBuckets = ['arti', 'articles', 'images', 'media', 'uploads', 'public'];
                let uploadSuccess = false;
                let publicUrl = null;
                
                for (const bucketName of possibleBuckets) {
                    try {
                        console.log(`üîÑ Tentative d'upload vers le bucket: ${bucketName}`);
                        
                        // Cr√©er un FormData pour l'upload
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        // Upload vers Supabase Storage
                        const response = await fetch(`${SUPABASE_URL}/storage/v1/object/${bucketName}/${fileName}`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                                'apikey': SUPABASE_ANON_KEY
                            },
                            body: formData
                        });

                        if (response.ok) {
                            // Retourner l'URL publique du fichier
                            publicUrl = `${SUPABASE_URL}/storage/v1/object/public/${bucketName}/${fileName}`;
                            console.log(`‚úÖ Fichier upload√© avec succ√®s vers ${bucketName}:`, publicUrl);
                            uploadSuccess = true;
                            break;
                        } else {
                            const errorText = await response.text();
                            if (response.status === 403) {
                                console.log(`üîí Bucket ${bucketName} non autoris√© (RLS):`, response.status, errorText);
                            } else {
                                console.log(`‚ö†Ô∏è Bucket ${bucketName} non disponible:`, response.status, errorText);
                            }
                            // Continuer avec le bucket suivant si c'est une erreur 404, 400 ou 403 (bucket non trouv√© ou non autoris√©)
                            if (response.status === 404 || response.status === 400 || response.status === 403) {
                                continue;
                            }
                        }
                    } catch (error) {
                        console.log(`‚ö†Ô∏è Erreur avec le bucket ${bucketName}:`, error);
                    }
                }
                
                if (!uploadSuccess) {
                    console.log('üîÑ Aucun bucket accessible (RLS ou permissions), utilisation du fallback Base64...');
                    return await fallbackVideoUpload(file, fileName);
                }
                
                return publicUrl;
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'upload vers Supabase Storage:', error);
                throw error;
            }
        }

        // Fonction pour cr√©er le bucket s'il n'existe pas
        async function createBucketIfNotExists() {
            try {
                const response = await fetch(`${SUPABASE_URL}/storage/v1/bucket`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: 'articles',
                        name: 'articles',
                        public: true
                    })
                });

                if (response.ok) {
                    console.log('‚úÖ Bucket "articles" cr√©√© avec succ√®s');
                } else if (response.status === 409) {
                    console.log('‚ÑπÔ∏è Bucket "articles" existe d√©j√†');
                } else {
                    console.log('‚ö†Ô∏è Impossible de cr√©er le bucket:', response.status);
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Erreur lors de la cr√©ation du bucket:', error);
            }
        }

        // Fonction de fallback pour les vid√©os (conversion en base64)
        async function fallbackVideoUpload(file, fileName) {
            console.log('üîÑ Utilisation du fallback base64 pour la vid√©o');
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Fonction pour lister les buckets disponibles
        async function listAvailableBuckets() {
            try {
                showNotification('üîÑ Recherche des buckets...', 'info');
                
                const response = await fetch(`${SUPABASE_URL}/storage/v1/bucket`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY
                    }
                });

                if (response.ok) {
                    const buckets = await response.json();
                    console.log('üì¶ Buckets disponibles:', buckets);
                    
                    if (buckets.length > 0) {
                        const bucketNames = buckets.map(b => b.name).join(', ');
                        showNotification(`‚úÖ Buckets trouv√©s: ${bucketNames}`, 'success');
                    } else {
                        showNotification('‚ÑπÔ∏è Aucun bucket trouv√©', 'info');
                    }
                    
                    return buckets.map(b => b.name);
                } else {
                    const errorText = await response.text();
                    showNotification(`‚ùå Erreur: ${response.status} - ${errorText}`, 'error');
                    console.log('‚ö†Ô∏è Impossible de lister les buckets:', response.status, errorText);
                    return [];
                }
            } catch (error) {
                showNotification('‚ùå Erreur lors de la liste des buckets', 'error');
                console.log('‚ö†Ô∏è Erreur lors de la liste des buckets:', error);
                return [];
            }
        }

        // Fonction pour cr√©er manuellement le bucket
        async function createBucketManually() {
            try {
                showNotification('üîÑ Cr√©ation du bucket en cours...', 'info');
                
                const response = await fetch(`${SUPABASE_URL}/storage/v1/bucket`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: 'articles',
                        name: 'articles',
                        public: true
                    })
                });

                if (response.ok) {
                    showNotification('‚úÖ Bucket "articles" cr√©√© avec succ√®s !', 'success');
                    console.log('‚úÖ Bucket cr√©√© avec succ√®s');
                } else if (response.status === 409) {
                    showNotification('‚ÑπÔ∏è Bucket "articles" existe d√©j√†', 'info');
                    console.log('‚ÑπÔ∏è Bucket existe d√©j√†');
                } else {
                    const errorText = await response.text();
                    showNotification(`‚ùå Erreur: ${response.status} - ${errorText}`, 'error');
                    console.error('‚ùå Erreur cr√©ation bucket:', response.status, errorText);
                }
            } catch (error) {
                showNotification('‚ùå Erreur lors de la cr√©ation du bucket', 'error');
                console.error('‚ùå Erreur:', error);
            }
        }
        
        function removeMedia() {
            selectedMediaFile = null;
            resetMediaUpload();
        }


        // ===== FONCTIONS VARIANTES DE PRIX =====

        function addVariant() {
            const container = document.getElementById('priceVariantsContainer');
            const variantItem = document.createElement('div');
            variantItem.className = 'variant-item';
            variantItem.innerHTML = `
                <input type="text" placeholder="Quantit√© (ex: 5g)" class="variant-quantity" name="variant_quantity[]">
                <input type="number" placeholder="Prix" step="0.01" class="variant-price" name="variant_price[]">
                <button type="button" class="remove-variant" onclick="removeVariant(this)">‚úï</button>
            `;
            container.appendChild(variantItem);
        }

        function removeVariant(button) {
            button.parentElement.remove();
        }

        function loadPriceVariants(variants) {
            const container = document.getElementById('priceVariantsContainer');
            container.innerHTML = '';

            if (variants.length === 0) {
                addVariant();
            } else {
                variants.forEach(variant => {
                    const variantItem = document.createElement('div');
                    variantItem.className = 'variant-item';
                    variantItem.innerHTML = `
                        <input type="text" placeholder="Quantit√© (ex: 5g)" class="variant-quantity" name="variant_quantity[]" value="${variant.quantity || ''}">
                        <input type="number" placeholder="Prix" step="0.01" class="variant-price" name="variant_price[]" value="${variant.price || ''}">
                        <button type="button" class="remove-variant" onclick="removeVariant(this)">‚úï</button>
                    `;
                    container.appendChild(variantItem);
                });
            }
        }

        function resetPriceVariants() {
            loadPriceVariants([]);
        }

        function getPriceVariants() {
            const container = document.getElementById('priceVariantsContainer');
            const variants = [];
            
            container.querySelectorAll('.variant-item').forEach(item => {
                const quantity = item.querySelector('.variant-quantity').value.trim();
                const price = parseFloat(item.querySelector('.variant-price').value);
                
                if (quantity && !isNaN(price)) {
                    variants.push({ quantity, price });
                }
            });
            
            return variants;
        }

        // ===== AM√âLIORATION DES STATS =====

        function loadAnalytics() {
            const statsContainer = document.getElementById('statsContainer');
            
            const totalArticles = articles.length;
            const stupCount = articles.filter(a => a.category === 'stup').length;
            const tabacCount = articles.filter(a => a.category === 'tabac').length;
            const activeCount = articles.filter(a => a.status === 'active').length;
            const featuredCount = articles.filter(a => a.featured).length;
            const totalStock = articles.reduce((sum, a) => sum + a.stock, 0);
            const avgPrice = articles.length > 0 ? (articles.reduce((sum, a) => sum + a.price, 0) / articles.length).toFixed(2) : 0;

            statsContainer.innerHTML = `
                <div class="stats-card">
                    <h4>Total Articles</h4>
                    <div class="stat-number">${totalArticles}</div>
                </div>
                <div class="stats-card">
                    <h4>STUP</h4>
                    <div class="stat-number">${stupCount}</div>
                </div>
                <div class="stats-card">
                    <h4>TABAC</h4>
                    <div class="stat-number">${tabacCount}</div>
                </div>
                <div class="stats-card">
                    <h4>Actifs</h4>
                    <div class="stat-number">${activeCount}</div>
                </div>
                <div class="stats-card">
                    <h4>Featured</h4>
                    <div class="stat-number">${featuredCount}</div>
                </div>
                <div class="stats-card">
                    <h4>Stock Total</h4>
                    <div class="stat-number">${totalStock}</div>
                </div>
                <div class="stats-card">
                    <h4>Prix Moyen</h4>
                    <div class="stat-number">${avgPrice}‚Ç¨</div>
                </div>
            `;
        }

        // Fonction pour optimiser l'affichage mobile
        function setupMobileOptimizations() {
            if (isMobile()) {
                console.log('üì± Optimisations mobiles activ√©es pour le panel admin');
                
                // Ajouter des classes CSS pour mobile
                document.body.classList.add('mobile-device');
                
                // Optimiser les zones de clic pour le tactile
                const clickableElements = document.querySelectorAll('.btn, .nav-item, .article-card, .modal-close');
                clickableElements.forEach(element => {
                    element.style.minHeight = '44px';
                    element.style.minWidth = '44px';
                });
                
                // Forcer le chargement des vid√©os
                const videos = document.querySelectorAll('video');
                videos.forEach(video => {
                    video.setAttribute('playsinline', 'true');
                    video.setAttribute('webkit-playsinline', 'true');
                    video.setAttribute('preload', 'metadata');
                    video.load();
                });
            }
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier la session existante
            checkSession();
            
            // Ajouter l'√©v√©nement de connexion au formulaire
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Optimiser pour mobile
            setupMobileOptimizations();
            
            // Charger les donn√©es si connect√©
            if (isLoggedIn) {
            // Charger les articles si connect√©
            loadArticles();
                
                // Charger les informations si connect√© (avec un petit d√©lai pour laisser Supabase s'initialiser)
                setTimeout(() => {
                    console.log('üîÑ Tentative de chargement des informations...');
                    loadInfoItems();
                }, 100);
            } else {
                // M√™me si pas connect√©, essayer de charger les informations pour les donn√©es d'exemple
                setTimeout(() => {
                    console.log('üîÑ Chargement des informations (mode non connect√©)...');
                    loadInfoItems();
                }, 200);
            }
        });
    </script>
</body>
</html>
